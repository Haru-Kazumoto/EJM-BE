import{x as Ie,z as ve,r as s,R as H,E as J,y as Me,U as Ne,a as e,an as Ae,j as p,B as Le,T as I,F as T,D as ue,aP as Qe,aq as L,ap as re,h as Se,am as ze,a_ as Te,a2 as je,f as de,g as Be}from"./index.990a5e8d.js";import{P as X}from"./PagePadding.be31ae21.js";import{D as te}from"./Detailinformation.d7a548a1.js";import{C as Ge}from"./CommentsIcon.63416927.js";import{F as Oe}from"./FileIcon.d7463855.js";import{d as Ue}from"./dayjs.min.c0afd17f.js";import{A as Ke,S as We}from"./index.esm.b56a107f.js";import{T as ne}from"./index.esm.3c7789c6.js";import{E as He}from"./EditIcon.b6b72d62.js";import{u as ye,F as U,a as xe}from"./FormFieldControl.8ea8ed9e.js";import{m as Ve,I as Ce,B as ae}from"./index.esm.27876472.js";import{i as $e,F as Ye,a as Je,I as Xe,c as Ze,f as et,g as tt}from"./index.esm.86199dec.js";import{t as nt}from"./index.238261e4.js";import{F as Z}from"./FieldTextArea.628a288f.js";import{c as ot,C as oe,a as ke}from"./index.esm.4df639b5.js";import{F as rt}from"./FieldText.f2654eae.js";import{F as me}from"./FieldCustom.a9e1b9bb.js";import{u as Pe,a as at,G as Fe,b as we}from"./useSelectDataMapper.40d26318.js";import{u as st}from"./useDebounce.51d664ab.js";import{b as it}from"./usersActions.739bb39b.js";import{S as lt}from"./select.1937eae9.js";import{S as ct,c as ut,f as dt,h as mt,i as ht}from"./projectActions.5a81ee6f.js";import{F as pt}from"./FilterIcon.57294db7.js";import{E as gt}from"./ErrorFetching.fd4f3ed6.js";import{u as he,E as ft}from"./useError.dd598f5e.js";import{A as bt}from"./ArrowLeftIcon.e64cc763.js";import{f as vt}from"./questionActions.3af83eea.js";import{E as pe}from"./ErrorEmpty.a2e6d48b.js";import"./slicedToArray.925b8532.js";import"./index.esm.3fa18c93.js";import"./index.esm.c75d359e.js";import"./objectWithoutPropertiesLoose.2d2ba74a.js";import"./useTranslation.0fd06a78.js";var St=(...t)=>t.filter(Boolean).join(" ");function ge(t){const o=typeof t;return t!=null&&(o==="object"||o==="function")&&!Array.isArray(t)}var _=t=>t?"":void 0,ee=t=>t?!0:void 0;function R(...t){return function(n){t.some(r=>(r==null||r(n),n==null?void 0:n.defaultPrevented))}}function yt(...t){return function(n){t.forEach(r=>{r==null||r(n)})}}function xt(t,o){const n={},r={};for(const[a,c]of Object.entries(t))o.includes(a)?n[a]=c:r[a]=c;return[n,r]}function Ct(t){return t&&ge(t)&&ge(t.target)}function kt(t={}){const{onChange:o,value:n,defaultValue:r,name:a,isDisabled:c,isFocusable:m,isNative:h,...b}=t,[l,C]=s.exports.useState(r||""),g=typeof n<"u",k=g?n:l,S=s.exports.useRef(null),F=s.exports.useCallback(()=>{const u=S.current;if(!u)return;let f="input:not(:disabled):checked";const q=u.querySelector(f);if(q){q.focus();return}f="input:not(:disabled)";const P=u.querySelector(f);P==null||P.focus()},[]),y=`radio-${s.exports.useId()}`,x=a||y,A=s.exports.useCallback(u=>{const f=Ct(u)?u.target.value:u;g||C(f),o==null||o(String(f))},[o,g]),K=s.exports.useCallback((u={},f=null)=>({...u,ref:Ve(f,S),role:"radiogroup"}),[]),N=s.exports.useCallback((u={},f=null)=>({...u,ref:f,name:x,[h?"checked":"isChecked"]:k!=null?u.value===k:void 0,onChange(P){A(P)},"data-radiogroup":!0}),[h,x,A,k]);return{getRootProps:K,getRadioProps:N,name:x,ref:S,focus:F,setValue:C,value:k,onChange:A,isDisabled:c,isFocusable:m,htmlProps:b}}var[Pt,_e]=Ie({name:"RadioGroupContext",strict:!1}),qe=ve((t,o)=>{const{colorScheme:n,size:r,variant:a,children:c,className:m,isDisabled:h,isFocusable:b,...l}=t,{value:C,onChange:g,getRootProps:k,name:S,htmlProps:F}=kt(l),M=s.exports.useMemo(()=>({name:S,size:r,onChange:g,colorScheme:n,value:C,variant:a,isDisabled:h,isFocusable:b}),[S,r,g,n,C,a,h,b]);return H.createElement(Pt,{value:M},H.createElement(J.div,{...k(F,o),className:St("chakra-radio-group",m)},c))});qe.displayName="RadioGroup";var Ft={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function wt(t={}){const{defaultChecked:o,isChecked:n,isFocusable:r,isDisabled:a,isReadOnly:c,isRequired:m,onChange:h,isInvalid:b,name:l,value:C,id:g,"data-radiogroup":k,"aria-describedby":S,...F}=t,M=`radio-${s.exports.useId()}`,y=$e(),A=!!_e()||!!k;let N=!!y&&!A?y.id:M;N=g!=null?g:N;const u=a!=null?a:y==null?void 0:y.isDisabled,f=c!=null?c:y==null?void 0:y.isReadOnly,q=m!=null?m:y==null?void 0:y.isRequired,P=b!=null?b:y==null?void 0:y.isInvalid,[W,E]=s.exports.useState(!1),[Q,j]=s.exports.useState(!1),[B,G]=s.exports.useState(!1),[V,z]=s.exports.useState(!1),[Y,i]=s.exports.useState(Boolean(o)),v=typeof n<"u",w=v?n:Y;s.exports.useEffect(()=>nt(E),[]);const $=s.exports.useCallback(d=>{if(f||u){d.preventDefault();return}v||i(d.target.checked),h==null||h(d)},[v,u,f,h]),D=s.exports.useCallback(d=>{d.key===" "&&z(!0)},[z]),se=s.exports.useCallback(d=>{d.key===" "&&z(!1)},[z]),De=s.exports.useCallback((d={},O=null)=>({...d,ref:O,"data-active":_(V),"data-hover":_(B),"data-disabled":_(u),"data-invalid":_(P),"data-checked":_(w),"data-focus":_(Q),"data-focus-visible":_(Q&&W),"data-readonly":_(f),"aria-hidden":!0,onMouseDown:R(d.onMouseDown,()=>z(!0)),onMouseUp:R(d.onMouseUp,()=>z(!1)),onMouseEnter:R(d.onMouseEnter,()=>G(!0)),onMouseLeave:R(d.onMouseLeave,()=>G(!1))}),[V,B,u,P,w,Q,f,W]),{onFocus:ie,onBlur:le}=y!=null?y:{},Re=s.exports.useCallback((d={},O=null)=>{const ce=u&&!r;return{...d,id:N,ref:O,type:"radio",name:l,value:C,onChange:R(d.onChange,$),onBlur:R(le,d.onBlur,()=>j(!1)),onFocus:R(ie,d.onFocus,()=>j(!0)),onKeyDown:R(d.onKeyDown,D),onKeyUp:R(d.onKeyUp,se),checked:w,disabled:ce,readOnly:f,required:q,"aria-invalid":ee(P),"aria-disabled":ee(ce),"aria-required":ee(q),"data-readonly":_(f),"aria-describedby":S,style:Ft}},[u,r,N,l,C,$,le,ie,D,se,w,f,q,P,S]);return{state:{isInvalid:P,isFocused:Q,isChecked:w,isActive:V,isHovered:B,isDisabled:u,isReadOnly:f,isRequired:q},getCheckboxProps:De,getInputProps:Re,getLabelProps:(d={},O=null)=>({...d,ref:O,onMouseDown:R(d.onMouseDown,fe),onTouchStart:R(d.onTouchStart,fe),"data-disabled":_(u),"data-checked":_(w),"data-invalid":_(P)}),getRootProps:(d,O=null)=>({...d,ref:O,"data-disabled":_(u),"data-checked":_(w),"data-invalid":_(P)}),htmlProps:F}}function fe(t){t.preventDefault(),t.stopPropagation()}var Ee=ve((t,o)=>{var G;const n=_e(),{onChange:r,value:a}=t,c=Me("Radio",{...n,...t}),m=Ne(t),{spacing:h="0.5rem",children:b,isDisabled:l=n==null?void 0:n.isDisabled,isFocusable:C=n==null?void 0:n.isFocusable,inputProps:g,...k}=m;let S=t.isChecked;(n==null?void 0:n.value)!=null&&a!=null&&(S=n.value===a);let F=r;(n==null?void 0:n.onChange)&&a!=null&&(F=yt(n.onChange,r));const M=(G=t==null?void 0:t.name)!=null?G:n==null?void 0:n.name,{getInputProps:y,getCheckboxProps:x,getLabelProps:A,getRootProps:K,htmlProps:N}=wt({...k,isChecked:S,isFocusable:C,isDisabled:l,onChange:F,name:M}),[u,f]=xt(N,Ae),q=x(f),P=y(g,o),W=A(),E=Object.assign({},u,K()),Q={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...c.container},j={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...c.control},B={userSelect:"none",marginStart:h,...c.label};return H.createElement(J.label,{className:"chakra-radio",...E,__css:Q},e("input",{className:"chakra-radio__input",...P}),H.createElement(J.span,{className:"chakra-radio__control",...q,__css:j}),b&&H.createElement(J.span,{className:"chakra-radio__label",...W,__css:B},b))});Ee.displayName="Radio";const _t=({onClick:t,active:o,question_title:n,answered_at:r,answered_by_name:a,answered_by_profile:c})=>p(s.exports.Fragment,{children:[p(Le,{p:3,_hover:{backgroundColor:"rgba(104,211,145,0.35)"},onClick:t,backgroundColor:o?"rgba(104,211,145,0.50)":"transparent",cursor:"pointer",children:[e(I,{fontSize:15,fontWeight:"medium",noOfLines:2,children:n}),p(T,{alignItems:"center",children:[e(te,{label:e(I,{fontSize:11,children:"Answered By"}),direction:"column",value:p(T,{gap:2,alignItems:"center",children:[e(Ke,{size:"xs",objectFit:"cover",name:a!=null?a:"",src:c?`/api/v1/profiles/${c}`:"/default-image.jpg"}),e(I,{fontSize:12,children:a!=null?a:""})]})}),e(te,{label:e(I,{fontSize:11,children:"Answered At"}),direction:"column",value:r?e(I,{fontSize:12,children:Ue(r).fromNow()}):"-"})]}),e(ue,{my:1}),p(T,{alignItems:"center",gap:2,children:[e(ne,{label:"0 Comments",children:p(T,{gap:1,children:[e(Ge,{fontSize:20}),e(I,{fontSize:13,opacity:.5,children:"0"})]})}),e(ne,{label:"2 Attachments",children:p(T,{gap:1,children:[e(Oe,{fontSize:20}),e(I,{fontSize:13,opacity:.5,children:"0"})]})})]})]}),e(ue,{})]}),qt=({id:t,placeholder:o,label:n,isRequired:r=!1,errorMessage:a,type:c="text",leftElement:m,rightElement:h,isInvalid:b=!1,formState:l,direction:C="row",options:g,...k})=>p(Ye,{isRequired:r,isInvalid:b,children:[n&&n!==""?e(Je,{htmlFor:t,children:n}):null,p(Xe,{children:[m&&e(Ze,{pointerEvents:"none",alignItems:"center",children:m}),e(qe,{...k,children:e(Qe,{direction:C,children:g&&g.length>0?g.map(S=>e(Ee,{value:S.value,children:S.label})):null})}),h&&e(et,{alignItems:"center",children:h})]}),e(tt,{children:a})]}),Et=({options:t})=>{const{control:o,formState:n,watch:r}=ye(),a=r("choosed"),c=s.exports.useMemo(()=>{if(t&&t.length>0){const m=t.find(h=>h.name===a);return e(s.exports.Fragment,{children:m&&m.conditions&&m.conditions.length>0&&m.conditions.map((h,b)=>e(L,{children:e(U,{control:o,formState:n,name:h.name,label:h.name,id:h.name,rules:{required:{value:h.is_mandatory,message:"Dibutuhkan"}},children:e(Z,{rows:3})})}))})}else return null},[a,t]);return p(re,{templateColumns:"repeat(1,1fr)",gap:5,children:[t&&t.length>0?e(L,{children:e(U,{control:o,formState:n,name:"choosed",id:"choosed",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(qt,{options:t.map(m=>({label:m.name,value:m.name})),direction:"column"})})}):e(L,{children:e(U,{control:o,formState:n,name:"description",id:"description",label:"Deskripsi",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(Z,{rows:3})})}),c,e(L,{children:e(U,{control:o,formState:n,name:"keterangan",label:"Keterangan",id:"keterangan",children:e(Z,{rows:5})})})]})},Dt=({editable:t=!1,data:o,onAnswer:n,initialValues:r={choosed:null,keterangan:null,attachment:void 0},isLoading:a=!1,getDetailLoading:c=!1})=>p(s.exports.Fragment,{children:[e(ot,{children:p(T,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",children:[e(I,{fontWeight:"medium",fontSize:19,children:o.name}),t?e(ne,{label:"Edit Question",children:e(Ce,{"aria-label":"Edit",variant:"unstyled",icon:e(He,{fontSize:28,color:"yellow.400"})})}):null]})}),p(X,{x:6,y:6,children:[c&&"Loading...",!c&&p(xe,{onSubmit:n,id:"form-question",initialValues:r,children:[e(Et,{options:o.answers}),e(ae,{type:"submit",mt:5,isLoading:a,children:"Submit"})]})]})]}),Rt=H.forwardRef(({name:t,onChange:o,onBlur:n,value:r,placeholder:a},c)=>{const[m,h]=s.exports.useState(""),b=st(m,1e3),{fetchNextPage:l,hasNextPage:C,isError:g,isSuccess:k,isLoading:S,data:F,isFetchingNextPage:M}=Pe(["fetch_select_users",b,r],({pageParam:x=1})=>it({current:x,search:b,value:r==null?void 0:r.value,pageSize:15}),{getNextPageParam:x=>Fe(x),getPreviousPageParam:x=>we(x)}),y=at({isSuccess:k,data:F!=null?F:{pages:[],pageParams:[]},key:"users",returnList:x=>({label:`${x.username} - ${x.full_name}`,value:x.id})});return e(lt,{name:t,ref:c,onChange:o,onBlur:n,value:r,onInputChange:h,isLoading:M||S,isClearable:!0,noOptionsMessage:({inputValue:x})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:x})=>p(Se,{children:[p("div",{children:['Mencari "',x,'"']}),S&&e(ze,{size:"xs",width:"100%",isIndeterminate:!0}),g&&e("div",{children:"Error saat mencari data"})]}),options:y,placeholder:e(I,{noOfLines:[1],children:a}),closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{C&&l()},closeMenuOnSelect:!0})}),It=()=>{const{control:t,formState:o}=ye();return p(re,{templateColumns:{base:"repeat(1,1fr)",md:"repeat(3,1fr)"},gap:4,children:[e(L,{children:e(U,{placeholder:"-- Cari Pertanyaan --",control:t,name:"question_search",formState:o,id:"question_search",children:e(rt,{})})}),e(L,{children:e(U,{placeholder:"-- Pilih Status Pertanyaan --",control:t,name:"question_status",formState:o,id:"question_status",children:e(me,{children:e(ct,{type_:"QUESTION_STATUS"})})})}),e(L,{children:e(U,{placeholder:"-- Pilih Dijawab Siapa --",control:t,name:"question_answered_by",formState:o,id:"question_answered_by",children:e(me,{children:e(Rt,{})})})})]})},Mt=({onSubmit:t})=>e(oe,{children:p(ke,{children:[e(I,{fontWeight:"medium",mb:3,children:"Filter data"}),p(xe,{onSubmit:t,id:"form-questionaire",children:[e(It,{}),e(ae,{leftIcon:e(pt,{}),mt:5,size:"sm",type:"submit",children:"Filter"})]})]})}),be="DESCRIPTION_ANSWERED",bn=s.exports.forwardRef(({structuresId:t,projectId:o,editable:n=!1},r)=>{var Y;const[a,c]=s.exports.useState(t),[m,h]=s.exports.useState(o),[b]=Te(),[l,C]=s.exports.useState(null),[g,k]=s.exports.useState({question_answered_by:null,question_search:null,question_status:null});s.exports.useImperativeHandle(r,()=>({removeFilterQuestions(){k({question_answered_by:null,question_search:null,question_status:null}),C(null)}}));const S=je();he(ut);const F=he(dt);s.exports.useEffect(()=>{h(o!=null?o:+b.get("projectId")),c(t!=null?t:b.get("structureId"))},[t,b.get("structureId"),o,b.get("projectId")]);const{isSuccess:M,isLoading:y,isError:x,data:A}=de(["detail_structure",t,o],()=>mt({structureId:t,projectId:o}),{enabled:!!t&&!!o}),{isSuccess:K,isLoading:N,isError:u,refetch:f,data:q,hasNextPage:P,fetchNextPage:W}=Pe(["questions",a,m,{...g}],({pageParam:i=1})=>ht({id:a,prjId:m,current:i,answered_by:g.question_answered_by,status_answered:g.question_status,search:g.question_search,pageSize:15}),{enabled:!!a,getNextPageParam:i=>Fe(i),getPreviousPageParam:i=>we(i)}),{data:E,isLoading:Q,isSuccess:j}=de(["answered_question",l==null?void 0:l.id],()=>vt(l==null?void 0:l.id),{cacheTime:0,staleTime:0,enabled:!!(l!=null&&l.id)}),B=s.exports.useMemo(()=>{let i={};return j?(E.data.conditions&&E.data.conditions.map(v=>{i[v.label]=v.value}),E.data.answer_label===be?{description:E.data.description,keterangan:E.data.note,attachment:void 0,...i}:{choosed:E.data.answer_label,keterangan:E.data.note,attachment:void 0,...i}):{choosed:null,keterangan:null,attachment:void 0}},[j,E]),G=i=>{var v,w;k({question_status:(v=i.question_status)==null?void 0:v.value,question_search:i.question_search,question_answered_by:(w=i.question_answered_by)==null?void 0:w.value})},V=i=>{var $;let v,w;i!=null&&i.choosed?(w=l.answers.find(D=>D.name===i.choosed),v=w.conditions.map(D=>({label:D.name,value:i==null?void 0:i[D.name]}))):v=null,F.mutate({answer:{conditions:v,keterangan:i.keterangan,label:($=i==null?void 0:i.choosed)!=null?$:be,value:w?w.value.toString():i.description},question_id:l.id},{onSuccess:D=>{S({position:"top",title:"Success",description:D.message,isClosable:!0}),C(null),f()},onError:D=>ft(D,S)})},z=i=>{C(i)};return e(s.exports.Fragment,{children:u?e(gt,{}):p(s.exports.Fragment,{children:[p(X,{x:0,y:2,children:[y&&e(We,{w:"100%",h:100}),x&&e(I,{children:"Error Menampilkan Detail Struktur"}),M&&e(oe,{children:e(ke,{children:e(te,{maxW:"100%",direction:"column",label:"Unit Kerja",value:A.data.name})})})]}),e(X,{x:0,y:2,children:e(Mt,{onSubmit:G})}),e(X,{x:0,y:3,children:e(oe,{children:p(re,{templateColumns:"repeat(5,1fr)",children:[p(L,{colSpan:{base:5,lg:l?2:5},display:{base:l?"none":"block",lg:"block"},borderRight:{base:0,lg:.5},borderStyle:"solid",borderColor:"grey.200",maxH:{lg:700},minH:{base:700},overflowY:{lg:"auto"},_dark:{borderColor:"grey.600"},children:[N&&e(Be,{}),K&&q.pages[0].questions&&((Y=q.pages[0].questions)==null?void 0:Y.length)>0?q.pages.map(i=>i.questions&&i.questions.length>0?p(Se,{children:[i.questions.map(v=>e(_t,{question_title:v.name,onClick:()=>z(v),answered_at:v.answered_at,active:(l==null?void 0:l.id)===(v==null?void 0:v.id),answered_by_name:v.answered_by_name,answered_by_profile:v.answered_by_profile})),P&&e(T,{mt:5,justifyContent:"center",children:e(ae,{size:"sm",onClick:()=>W(),children:"Load More"})})]}):e(pe,{})):e(T,{alignItems:"center",justifyContent:"center",h:"100%",children:e(pe,{})})]}),l&&p(L,{colSpan:{base:l?5:0,lg:3},display:{base:l?"block":"none",lg:"block"},children:[e(Ce,{"aria-label":"Comeback",display:{base:"block",lg:"none"},variant:"outline",onClick:()=>C(null),icon:e(bt,{}),ml:5,mt:5}),e(Dt,{editable:n,data:l,onAnswer:V,initialValues:B,getDetailLoading:Q,isLoading:F.isLoading})]})]})})})]})})});export{bn as default};
