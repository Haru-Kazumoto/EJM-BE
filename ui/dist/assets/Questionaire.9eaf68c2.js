import{x as Ae,z as fe,r as c,R as Q,E as V,y as Le,U as Te,a as e,an as Ne,j as m,B as je,T as q,F as T,D as le,a_ as Qe,aq as A,ap as Z,t as be,am as Se,aY as ze,a2 as Be,f as ce,h as Oe}from"./index.d5331035.js";import{P as Y}from"./PagePadding.6a89d5ea.js";import{D as ue}from"./Detailinformation.5aa86740.js";import{C as Ge}from"./CommentsIcon.838980c6.js";import{F as Ue}from"./FileIcon.1e15d970.js";import{d as Ve}from"./dayjs.min.1ac82686.js";import{A as Ke}from"./index.esm.62102add.js";import{T as J}from"./index.esm.18904467.js";import{E as We}from"./EditIcon.553b3055.js";import{u as ee,F as L,a as te}from"./FormFieldControl.99f86f5b.js";import{m as He,I as ve,B as K}from"./index.esm.50eb2b01.js";import{i as $e,F as Ye,a as Je,I as Xe,c as Ze,f as et,g as tt}from"./index.esm.366f799e.js";import{t as nt}from"./index.esm.cabc1829.js";import{F as de}from"./FieldTextArea.9f9d6dee.js";import{F as ot}from"./FieldUpload.6c21e74d.js";import{c as at,C as xe,a as rt}from"./index.esm.41a77411.js";import{F as st}from"./FieldText.45c302a0.js";import{F as X}from"./FieldCustom.5a5ed46b.js";import{u as Pe,a as Ce,G as ke,b as ye}from"./useSelectDataMapper.6165c842.js";import{u as Fe}from"./useDebounce.d3519829.js";import{b as it}from"./usersActions.d6b8993a.js";import{S as _e}from"./select.c3fc601f.js";import{S as lt}from"./SelectLookup.0085f43c.js";import{F as ct}from"./FilterIcon.bbce048c.js";import{b as ut,e as dt,f as mt}from"./projectActions.faa31347.js";import{E as pt}from"./ErrorFetching.68e00ec4.js";import{g as ht,f as gt}from"./questionActions.2cfe040f.js";import{F as ft}from"./FieldSwitch.9acdb8d0.js";import{S as bt}from"./SaveIcon.3da42341.js";import{u as me,E as pe}from"./useError.f7bb9bb4.js";import{A as St}from"./ArrowLeftIcon.b96504a8.js";import"./slicedToArray.8f26b531.js";import"./objectWithoutPropertiesLoose.2d2ba74a.js";import"./index.esm.66c8b54e.js";import"./index.esm.4093ec2b.js";import"./useTranslation.21f85c5c.js";var vt=(...t)=>t.filter(Boolean).join(" ");function he(t){const o=typeof t;return t!=null&&(o==="object"||o==="function")&&!Array.isArray(t)}var F=t=>t?"":void 0,$=t=>t?!0:void 0;function M(...t){return function(n){t.some(a=>(a==null||a(n),n==null?void 0:n.defaultPrevented))}}function xt(...t){return function(n){t.forEach(a=>{a==null||a(n)})}}function Pt(t,o){const n={},a={};for(const[s,u]of Object.entries(t))o.includes(s)?n[s]=u:a[s]=u;return[n,a]}function Ct(t){return t&&he(t)&&he(t.target)}function kt(t={}){const{onChange:o,value:n,defaultValue:a,name:s,isDisabled:u,isFocusable:p,isNative:d,...r}=t,[k,x]=c.exports.useState(a||""),v=typeof n<"u",P=v?n:k,b=c.exports.useRef(null),C=c.exports.useCallback(()=>{const h=b.current;if(!h)return;let S="input:not(:disabled):checked";const E=h.querySelector(S);if(E){E.focus();return}S="input:not(:disabled)";const i=h.querySelector(S);i==null||i.focus()},[]),f=`radio-${c.exports.useId()}`,l=s||f,w=c.exports.useCallback(h=>{const S=Ct(h)?h.target.value:h;v||x(S),o==null||o(String(S))},[o,v]),z=c.exports.useCallback((h={},S=null)=>({...h,ref:He(S,b),role:"radiogroup"}),[]),D=c.exports.useCallback((h={},S=null)=>({...h,ref:S,name:l,[d?"checked":"isChecked"]:P!=null?h.value===P:void 0,onChange(i){w(i)},"data-radiogroup":!0}),[d,l,w,P]);return{getRootProps:z,getRadioProps:D,name:l,ref:b,focus:C,setValue:x,value:P,onChange:w,isDisabled:u,isFocusable:p,htmlProps:r}}var[yt,we]=Ae({name:"RadioGroupContext",strict:!1}),Ie=fe((t,o)=>{const{colorScheme:n,size:a,variant:s,children:u,className:p,isDisabled:d,isFocusable:r,...k}=t,{value:x,onChange:v,getRootProps:P,name:b,htmlProps:C}=kt(k),_=c.exports.useMemo(()=>({name:b,size:a,onChange:v,colorScheme:n,value:x,variant:s,isDisabled:d,isFocusable:r}),[b,a,v,n,x,s,d,r]);return Q.createElement(yt,{value:_},Q.createElement(V.div,{...P(C,o),className:vt("chakra-radio-group",p)},u))});Ie.displayName="RadioGroup";var Ft={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function _t(t={}){const{defaultChecked:o,isChecked:n,isFocusable:a,isDisabled:s,isReadOnly:u,isRequired:p,onChange:d,isInvalid:r,name:k,value:x,id:v,"data-radiogroup":P,"aria-describedby":b,...C}=t,_=`radio-${c.exports.useId()}`,f=$e(),w=!!we()||!!P;let D=!!f&&!w?f.id:_;D=v!=null?v:D;const h=s!=null?s:f==null?void 0:f.isDisabled,S=u!=null?u:f==null?void 0:f.isReadOnly,E=p!=null?p:f==null?void 0:f.isRequired,i=r!=null?r:f==null?void 0:f.isInvalid,[I,R]=c.exports.useState(!1),[y,U]=c.exports.useState(!1),[O,G]=c.exports.useState(!1),[W,B]=c.exports.useState(!1),[De,Me]=c.exports.useState(Boolean(o)),H=typeof n<"u",N=H?n:De;c.exports.useEffect(()=>nt(R),[]);const ne=c.exports.useCallback(g=>{if(S||h){g.preventDefault();return}H||Me(g.target.checked),d==null||d(g)},[H,h,S,d]),oe=c.exports.useCallback(g=>{g.key===" "&&B(!0)},[B]),ae=c.exports.useCallback(g=>{g.key===" "&&B(!1)},[B]),Re=c.exports.useCallback((g={},j=null)=>({...g,ref:j,"data-active":F(W),"data-hover":F(O),"data-disabled":F(h),"data-invalid":F(i),"data-checked":F(N),"data-focus":F(y),"data-focus-visible":F(y&&I),"data-readonly":F(S),"aria-hidden":!0,onMouseDown:M(g.onMouseDown,()=>B(!0)),onMouseUp:M(g.onMouseUp,()=>B(!1)),onMouseEnter:M(g.onMouseEnter,()=>G(!0)),onMouseLeave:M(g.onMouseLeave,()=>G(!1))}),[W,O,h,i,N,y,S,I]),{onFocus:re,onBlur:se}=f!=null?f:{},qe=c.exports.useCallback((g={},j=null)=>{const ie=h&&!a;return{...g,id:D,ref:j,type:"radio",name:k,value:x,onChange:M(g.onChange,ne),onBlur:M(se,g.onBlur,()=>U(!1)),onFocus:M(re,g.onFocus,()=>U(!0)),onKeyDown:M(g.onKeyDown,oe),onKeyUp:M(g.onKeyUp,ae),checked:N,disabled:ie,readOnly:S,required:E,"aria-invalid":$(i),"aria-disabled":$(ie),"aria-required":$(E),"data-readonly":F(S),"aria-describedby":b,style:Ft}},[h,a,D,k,x,ne,se,re,oe,ae,N,S,E,i,b]);return{state:{isInvalid:i,isFocused:y,isChecked:N,isActive:W,isHovered:O,isDisabled:h,isReadOnly:S,isRequired:E},getCheckboxProps:Re,getInputProps:qe,getLabelProps:(g={},j=null)=>({...g,ref:j,onMouseDown:M(g.onMouseDown,ge),onTouchStart:M(g.onTouchStart,ge),"data-disabled":F(h),"data-checked":F(N),"data-invalid":F(i)}),getRootProps:(g,j=null)=>({...g,ref:j,"data-disabled":F(h),"data-checked":F(N),"data-invalid":F(i)}),htmlProps:C}}function ge(t){t.preventDefault(),t.stopPropagation()}var Ee=fe((t,o)=>{var G;const n=we(),{onChange:a,value:s}=t,u=Le("Radio",{...n,...t}),p=Te(t),{spacing:d="0.5rem",children:r,isDisabled:k=n==null?void 0:n.isDisabled,isFocusable:x=n==null?void 0:n.isFocusable,inputProps:v,...P}=p;let b=t.isChecked;(n==null?void 0:n.value)!=null&&s!=null&&(b=n.value===s);let C=a;(n==null?void 0:n.onChange)&&s!=null&&(C=xt(n.onChange,a));const _=(G=t==null?void 0:t.name)!=null?G:n==null?void 0:n.name,{getInputProps:f,getCheckboxProps:l,getLabelProps:w,getRootProps:z,htmlProps:D}=_t({...P,isChecked:b,isFocusable:x,isDisabled:k,onChange:C,name:_}),[h,S]=Pt(D,Ne),E=l(S),i=f(v,o),I=w(),R=Object.assign({},h,z()),y={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...u.container},U={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...u.control},O={userSelect:"none",marginStart:d,...u.label};return Q.createElement(V.label,{className:"chakra-radio",...R,__css:y},e("input",{className:"chakra-radio__input",...i}),Q.createElement(V.span,{className:"chakra-radio__control",...E,__css:U}),r&&Q.createElement(V.span,{className:"chakra-radio__label",...I,__css:O},r))});Ee.displayName="Radio";const wt=({onClick:t,active:o,question_title:n,answered_at:a,answered_by_name:s,answered_by_profile:u})=>m(c.exports.Fragment,{children:[m(je,{p:3,_hover:{backgroundColor:"rgba(104,211,145,0.35)"},onClick:t,backgroundColor:o?"rgba(104,211,145,0.50)":"transparent",cursor:"pointer",children:[e(q,{fontSize:15,fontWeight:"medium",noOfLines:2,children:n}),m(T,{alignItems:"center",children:[e(ue,{label:e(q,{fontSize:11,children:"Answered By"}),direction:"column",value:m(T,{gap:2,alignItems:"center",children:[e(Ke,{size:"xs",objectFit:"cover",name:s!=null?s:"",src:u?`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0}.VITE_BACKEND_URL}/profiles/${u}`:"/default-image.jpg"}),e(q,{fontSize:12,children:s!=null?s:""})]})}),e(ue,{label:e(q,{fontSize:11,children:"Answered At"}),direction:"column",value:a?Ve(a).fromNow():"-"})]}),e(le,{my:1}),m(T,{alignItems:"center",gap:2,children:[e(J,{label:"0 Comments",children:m(T,{gap:1,children:[e(Ge,{fontSize:20}),e(q,{fontSize:13,opacity:.5,children:"0"})]})}),e(J,{label:"2 Attachments",children:m(T,{gap:1,children:[e(Ue,{fontSize:20}),e(q,{fontSize:13,opacity:.5,children:"0"})]})})]})]}),e(le,{})]}),It=({id:t,placeholder:o,label:n,isRequired:a=!1,errorMessage:s,type:u="text",leftElement:p,rightElement:d,isInvalid:r=!1,formState:k,direction:x="row",options:v,...P})=>m(Ye,{isRequired:a,isInvalid:r,children:[n&&n!==""?e(Je,{htmlFor:t,children:n}):null,m(Xe,{children:[p&&e(Ze,{pointerEvents:"none",alignItems:"center",children:p}),e(Ie,{...P,children:e(Qe,{direction:x,children:v&&v.length>0?v.map(b=>e(Ee,{value:b.value,children:b.label})):null})}),d&&e(et,{alignItems:"center",children:d})]}),e(tt,{children:s})]}),Et=({options:t})=>{const{control:o,formState:n,watch:a}=ee(),s=a("choosed"),u=c.exports.useMemo(()=>{const p=t.find(d=>d.name===s);return e(c.exports.Fragment,{children:p&&p.conditions&&p.conditions.length>0&&p.conditions.map((d,r)=>e(A,{children:e(L,{control:o,formState:n,name:d.name,label:d.name,id:d.name,rules:{required:{value:d.is_mandatory,message:"Dibutuhkan"}},children:e(de,{rows:3})})}))})},[s,t]);return m(Z,{templateColumns:"repeat(1,1fr)",gap:5,children:[e(A,{children:e(L,{control:o,formState:n,name:"choosed",id:"choosed",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(It,{options:t.map(p=>({label:p.name,value:p.name})),direction:"column"})})}),u,e(A,{children:e(L,{control:o,formState:n,name:"keterangan",label:"Keterangan",id:"keterangan",children:e(de,{rows:5})})}),e(A,{children:e(L,{control:o,name:"attachment",formState:n,id:"attachment",label:"Lampiran",children:e(ot,{})})})]})},Dt=({editable:t=!1,data:o,onAnswer:n,initialValues:a={choosed:null,keterangan:null,attachment:void 0},isLoading:s=!1,getDetailLoading:u=!1})=>m(c.exports.Fragment,{children:[e(at,{children:m(T,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",children:[e(q,{fontWeight:"medium",fontSize:19,children:o.name}),t?e(J,{label:"Edit Question",children:e(ve,{"aria-label":"Edit",variant:"unstyled",icon:e(We,{fontSize:28,color:"yellow.400"})})}):null]})}),e(Y,{x:6,y:6,children:!u&&m(te,{onSubmit:n,id:"form-question",initialValues:a,children:[e(Et,{options:o.answers}),e(K,{type:"submit",mt:5,isLoading:s,children:"Submit"})]})})]}),Mt=Q.forwardRef(({name:t,onChange:o,onBlur:n,value:a,placeholder:s},u)=>{const[p,d]=c.exports.useState(""),r=Fe(p,1e3),{fetchNextPage:k,hasNextPage:x,isError:v,isSuccess:P,isLoading:b,data:C,isFetchingNextPage:_}=Pe(["fetch_select_users",r,a],({pageParam:l=1})=>it({current:l,search:r,value:a==null?void 0:a.value,pageSize:15}),{getNextPageParam:l=>ke(l),getPreviousPageParam:l=>ye(l)}),f=Ce({isSuccess:P,data:C!=null?C:{pages:[],pageParams:[]},key:"users",returnList:l=>({label:`${l.username} - ${l.full_name}`,value:l.id})});return e(_e,{name:t,ref:u,onChange:o,onBlur:n,value:a,onInputChange:d,isLoading:_||b,isClearable:!0,noOptionsMessage:({inputValue:l})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:l})=>m(be,{children:[m("div",{children:['Mencari "',l,'"']}),b&&e(Se,{size:"xs",width:"100%",isIndeterminate:!0}),v&&e("div",{children:"Error saat mencari data"})]}),options:f,placeholder:s,closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{x&&k()},closeMenuOnSelect:!0})}),Rt=()=>{const{control:t,formState:o}=ee();return m(Z,{templateColumns:{base:"repeat(1,1fr)",md:"repeat(3,1fr)"},gap:4,children:[e(A,{children:e(L,{placeholder:"-- Cari Pertanyaan --",control:t,name:"question_search",formState:o,id:"question_search",children:e(st,{})})}),e(A,{children:e(L,{placeholder:"-- Pilih Status Pertanyaan --",control:t,name:"question_status",formState:o,id:"question_status",children:e(X,{children:e(lt,{type_:"QUESTION_STATUS"})})})}),e(A,{children:e(L,{placeholder:"-- Pilih Dijawab Siapa --",control:t,name:"question_answered_by",formState:o,id:"question_answered_by",children:e(X,{children:e(Mt,{})})})})]})},qt=()=>e(xe,{children:m(rt,{children:[e(q,{fontWeight:"medium",mb:3,children:"Filter data"}),m(te,{onSubmit:t=>console.log(t),id:"form-questionaire",children:[e(Rt,{}),e(K,{leftIcon:e(ct,{}),mt:5,size:"sm",type:"submit",children:"Filter"})]})]})}),At=Q.forwardRef(({name:t,onChange:o,onBlur:n,value:a,placeholder:s},u)=>{const[p,d]=c.exports.useState(""),r=Fe(p,1e3),{fetchNextPage:k,hasNextPage:x,isError:v,isSuccess:P,isLoading:b,data:C,isFetchingNextPage:_}=Pe(["fetch_select_question_templates",r],({pageParam:l=1})=>ht({current:l,search:r,value:a==null?void 0:a.value,using_active:!0,pageSize:15}),{getNextPageParam:l=>ke(l),getPreviousPageParam:l=>ye(l)}),f=Ce({isSuccess:P,data:C!=null?C:{pages:[],pageParams:[]},key:"question_templates",returnList:l=>({label:l.name,value:l.id})});return e(_e,{name:t,ref:u,onChange:o,onBlur:n,value:a,onInputChange:d,isLoading:_||b,isClearable:!0,noOptionsMessage:({inputValue:l})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:l})=>m(be,{children:[m("div",{children:['Mencari "',l,'"']}),b&&e(Se,{size:"xs",width:"100%",isIndeterminate:!0}),v&&e("div",{children:"Error saat mencari data"})]}),options:f,placeholder:s,closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{x&&k()},closeMenuOnSelect:!0})}),Lt=()=>{const{control:t,formState:o}=ee();return m(T,{gap:5,flexDirection:"column",children:[e(L,{control:t,formState:o,name:"question_templates",placeholder:"Pilih Template",label:"Pilih Template",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(X,{children:e(At,{})})}),e(L,{control:t,formState:o,name:"question_setall",label:"Atur ke semua department",children:e(ft,{})})]})},Tt=({onSubmit:t})=>m(c.exports.Fragment,{children:[e(q,{fontSize:"lg",fontWeight:"medium",mb:5,textAlign:"center",children:"Pilih Template Pertanyaan untuk Melanjutkan"}),m(te,{id:"form-add-questions",onSubmit:t,children:[e(Lt,{}),e(K,{leftIcon:e(bt,{}),type:"submit",mt:5,children:"Simpan"})]})]}),kn=({structuresId:t,projectId:o,editable:n=!1})=>{const[a,s]=c.exports.useState(t),[u,p]=c.exports.useState(o),[d]=ze(),[r,k]=c.exports.useState(null),x=Be(),v=me(ut),P=me(dt);c.exports.useEffect(()=>{p(o!=null?o:+d.get("projectId")),s(t!=null?t:d.get("structureId"))},[t,d.get("structureId"),o,d.get("projectId")]);const{isSuccess:b,isLoading:C,isError:_,refetch:f,data:l}=ce(["questions",a,u],()=>mt({id:a,prjId:u}),{enabled:!!a}),{data:w,isLoading:z,isSuccess:D}=ce(["answered_question",r==null?void 0:r.id],()=>gt(r==null?void 0:r.id),{cacheTime:0,staleTime:0,enabled:!!(r!=null&&r.id)}),h=c.exports.useMemo(()=>{let i={};return D?(w.data.conditions&&w.data.conditions.map(I=>{i[I.label]=I.value}),{choosed:w.data.answer_label,keterangan:w.data.description,attachment:void 0,...i}):{choosed:null,keterangan:null,attachment:void 0}},[D,w]),S=i=>{var I;v.mutate({project_id:u,question_template_id:i.question_templates.value,is_set_to_all_department:(I=i.question_setall)!=null?I:!1,structure_id:a},{onSuccess:R=>{x({status:"success",title:"Success",position:"top",isClosable:!0,description:R.message}),f()},onError:R=>pe(R,x)})},E=i=>{const I=r.answers.find(y=>y.name===i.choosed),R=I.conditions.map(y=>({label:y.name,value:i==null?void 0:i[y.name]}));P.mutate({answer:{conditions:R,keterangan:i.keterangan,label:i.choosed,value:I.value.toString()},question_id:r.id},{onSuccess:y=>{x({position:"top",title:"Success",description:y.message,isClosable:!0}),k(null),f()},onError:y=>pe(y,x)})};return m(c.exports.Fragment,{children:[C&&e(Oe,{}),_&&e(pt,{}),b&&l.data&&l.data.length>0?m(c.exports.Fragment,{children:[e(Y,{x:0,y:2,children:e(qt,{})}),e(Y,{x:0,y:3,children:e(xe,{children:m(Z,{templateColumns:"repeat(5,1fr)",children:[m(A,{colSpan:{base:5,lg:r?2:5},display:{base:r?"none":"block",lg:"block"},borderRight:{base:0,lg:.5},borderStyle:"solid",borderColor:"grey.200",maxH:{lg:700},minH:{base:700},overflowY:{lg:"auto"},_dark:{borderColor:"grey.600"},children:[l.data.map(i=>e(wt,{question_title:i.name,onClick:()=>k(i),answered_at:i.answered_at,active:(r==null?void 0:r.id)===(i==null?void 0:i.id),answered_by_name:i.answered_by_name,answered_by_profile:i.answered_by_profile})),e(T,{mt:5,justifyContent:"center",children:e(K,{size:"sm",children:"Load More"})})]}),r&&m(A,{colSpan:{base:r?5:0,lg:3},display:{base:r?"block":"none",lg:"block"},children:[e(ve,{"aria-label":"Comeback",display:{base:"block",lg:"none"},variant:"outline",onClick:()=>k(null),icon:e(St,{}),ml:5,mt:5}),e(Dt,{editable:n,data:r,onAnswer:E,initialValues:h,getDetailLoading:z,isLoading:P.isLoading})]})]})})})]}):!_&&e(Tt,{onSubmit:S})]})};export{kn as default};
