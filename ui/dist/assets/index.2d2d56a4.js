import{R as T,r as b,a as e,j as m,t as D,am as I,ap as O,aq as v,f as Q,D as R}from"./index.2876ce8d.js";import{a as q,P as C}from"./PagePadding.01ff7a41.js";import{P as V}from"./PageHeader.af1fedb8.js";import{B as G}from"./BeTable.e5c0962a.js";import{U as J}from"./useTableHelper.763dcc57.js";import{u as Y,F as M,a as U}from"./FormFieldControl.f97789c6.js";import{F}from"./FieldCustom.93c1e23b.js";import{S as N}from"./SelectLookup.ab9414e1.js";import{S as H}from"./SelectCompanies.a581a3cd.js";import{u as k,G as B,b as z,a as E}from"./useSelectDataMapper.8f413d98.js";import{u as K}from"./useDebounce.efc0032c.js";import{h as w,i as A,j as W}from"./projectActions.ff01effc.js";import{S as L}from"./select.c489a6c9.js";import{F as X}from"./FilterIcon.b2078b68.js";import{d as Z}from"./dayjs.min.3b117df5.js";import{B as $}from"./index.esm.6e051443.js";import"./ArrowLeftIcon.de388376.js";import"./index.esm.ae337b1d.js";import"./index.esm.d399955a.js";import"./slicedToArray.84b5158f.js";import"./index.esm.f2cdd8ab.js";import"./index.esm.f54768d8.js";import"./SearchInput.79f6c32e.js";import"./useTranslation.251d09d2.js";import"./Pagination.5467061a.js";import"./ExpandLeftIcon.2a5c5954.js";import"./ExpandRightIcon.a9ec3603.js";import"./companyActions.e1c0b8bf.js";import"./objectWithoutPropertiesLoose.2d2ba74a.js";const ee=T.forwardRef(({name:c,onChange:u,onBlur:o,value:n,placeholder:j,watch:h,companyKey:p},_)=>{const[t,x]=b.exports.useState(""),d=K(t,1e3),a=h(p),{fetchNextPage:g,hasNextPage:y,isError:S,isSuccess:s,isLoading:i,data:l,isFetchingNextPage:f}=k(["fetch_select_project_by_company",d,a==null?void 0:a.value],({pageParam:r=1})=>w({current:r,search:d,value:n==null?void 0:n.value,company:a==null?void 0:a.value,pageSize:15}),{enabled:!!(a!=null&&a.value),getNextPageParam:r=>B(r),getPreviousPageParam:r=>z(r)}),P=E({isSuccess:s,data:l!=null?l:{pages:[],pageParams:[]},key:"projects",returnList:r=>({label:r.name,value:r.id})});return e(L,{name:c,ref:_,onChange:u,onBlur:o,value:n,onInputChange:x,isLoading:f||i,isClearable:!0,noOptionsMessage:({inputValue:r})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:r})=>m(D,{children:[m("div",{children:['Mencari "',r,'"']}),i&&e(I,{size:"xs",width:"100%",isIndeterminate:!0}),S&&e("div",{children:"Error saat mencari data"})]}),options:P,placeholder:j,closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{y&&g()},closeMenuOnSelect:!0})}),re=T.forwardRef(({name:c,onChange:u,onBlur:o,value:n,placeholder:j,watch:h,projectKey:p},_)=>{const[t,x]=b.exports.useState(""),d=K(t,1e3),a=h(p),{fetchNextPage:g,hasNextPage:y,isError:S,isSuccess:s,isLoading:i,data:l,isFetchingNextPage:f}=k(["fetch_select_structure_by_project",d,a==null?void 0:a.value],({pageParam:r=1})=>A({current:r,search:d,value:n==null?void 0:n.value,project:a==null?void 0:a.value,pageSize:15}),{enabled:!!(a!=null&&a.value),getNextPageParam:r=>B(r),getPreviousPageParam:r=>z(r)}),P=E({isSuccess:s,data:l!=null?l:{pages:[],pageParams:[]},key:"structures",returnList:r=>({label:r.name,value:r.uuid})});return e(L,{name:c,ref:_,onChange:u,onBlur:o,value:n,onInputChange:x,isLoading:f||i,isClearable:!0,noOptionsMessage:({inputValue:r})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:r})=>m(D,{children:[m("div",{children:['Mencari "',r,'"']}),i&&e(I,{size:"xs",width:"100%",isIndeterminate:!0}),S&&e("div",{children:"Error saat mencari data"})]}),options:P,placeholder:j,closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{y&&g()},closeMenuOnSelect:!0})}),ae=()=>{const{control:c,formState:u,watch:o,setValue:n}=Y();return b.exports.useEffect(()=>{n("project",null),n("structures",null)},[o("company")]),b.exports.useEffect(()=>{n("structures",null)},[o("project")]),m(O,{templateColumns:{base:"repeat(1,1fr)",md:"repeat(2,1fr)",lg:"repeat(4,1fr)"},gap:5,children:[e(v,{children:e(M,{placeholder:"-- Company --",control:c,name:"company",formState:u,label:"Company",id:"company",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{children:e(H,{})})})}),e(v,{children:e(M,{placeholder:"-- Project --",control:c,name:"project",formState:u,label:"Project",id:"project",watch:o,rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{children:e(ee,{companyKey:"company"})})})}),e(v,{children:e(M,{placeholder:"-- Company Structures --",control:c,name:"structures",formState:u,label:"Company Structures",id:"structures",watch:o,rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{children:e(re,{projectKey:"project"})})})}),e(v,{children:e(M,{placeholder:"-- Pilih Status Pertanyaan --",control:c,name:"project_status",formState:u,label:"Status Pertanyaan",id:"project_status",rules:{required:{value:!1,message:"Dibutuhkan"}},children:e(F,{children:e(N,{type_:"QUESTION_STATUS"})})})}),e(v,{children:e(M,{placeholder:"-- Project Type --",control:c,name:"project_type",formState:u,label:"Project Type",id:"project_type",children:e(F,{children:e(N,{type_:"PROJECT_TYPE"})})})})]})},ke=()=>{var g,y,S;const[c,u]=b.exports.useState({}),[o,n]=b.exports.useState({company:null,project:null,structures:null,project_type:null,project_status:null}),{setPagination:j,searchValue:h,pagination:p,handleSearch:_}=J(),{data:t,isLoading:x}=Q(["report",{searchValue:h,...p,...o}],()=>W({pageSize:p.pageSize,current:p.pageIndex+1,search:h,project_id:o.project,project_type:o.project_type,project_status:o.project_status,company_id:o.company,structure_id:o.structures}),{keepPreviousData:!1}),d=s=>{var i,l,f,P,r;n({structures:(i=s.structures)==null?void 0:i.value,company:(l=s.company)==null?void 0:l.value,project:(f=s.project)==null?void 0:f.value,project_type:(P=s.project_type)==null?void 0:P.value,project_status:(r=s.project_status)==null?void 0:r.value})},a=T.useMemo(()=>[{id:"No",header:"No",accessorFn:(s,i)=>i+1},{id:"Pertanyaan",header:"Pertanyaan",accessorKey:"name"},{id:"Status",header:"Status",accessorKey:"status"},{id:"Jawaban",header:"Jawaban",accessorKey:"full_name"},{id:"Jawaban tambahan",header:"Jawaban tambahan"},{id:"Tanggal Terjawab",header:"Tanggal Terjawab",accessorKey:"answered_at",cell:({row:s})=>{var i;return Z((i=s.original)==null?void 0:i.answered_at).format("DD MMMM YYYY")}}],[]);return m(q,{title:"Report Questionaire",children:[e(V,{label:"Report Questionaire"}),e(R,{}),e(C,{x:6,y:6,children:m(U,{onSubmit:d,id:"form-filter-report-questioner",children:[e(ae,{}),e($,{mt:5,leftIcon:e(X,{}),type:"submit",children:"Filter"})]})}),e(C,{x:0,y:6,children:e(G,{enableResizeColumn:!1,useSearchInput:!0,loading:x,onSearch:_,rowKey:(s,i,l)=>s==null?void 0:s.id,onChangeTable:j,onCheckboxChange:u,pagination:{pageIndex:Number((g=t==null?void 0:t.page)!=null?g:0)-1,pageSize:Number((y=t==null?void 0:t.page_size)!=null?y:10)},pageCount:Number((S=t==null?void 0:t.page_count)!=null?S:0),rowSelectionProps:c,totalRecords:t==null?void 0:t.total,data:(t==null?void 0:t.projects)||[],columns:a})})]})};export{ke as default};
