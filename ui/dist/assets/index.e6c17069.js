import{R as H,r as x,a as e,j as d,h as X,an as ae,T as te,F as O,aq as Q,ar as h,ak as _,f as Y,B as q,d as ne,ae as se,a4 as ie,c as Te,aL as Ae}from"./index.4df5dae3.js";import{P as Ee}from"./Page.ce903aa1.js";import{P as Z}from"./PagePadding.8c1b0086.js";import{P as xe}from"./PageHeader.954bf5c1.js";import{S as Fe}from"./SettingsIcon.0a0ee6aa.js";import{g as re}from"./TableCheckbox.24618c03.js";import{E as oe}from"./EditIcon.3ffc7b25.js";import{D as E}from"./DeleteIcon.8cd44a6f.js";import{B as le}from"./BeTable.0069771f.js";import{g as ce,c as Ne,d as Be,a as Le,u as Oe}from"./menusAction.ed41850a.js";import{U as ue}from"./useTableHelper.39837f07.js";import{u as G,b as de,F as f,a as U}from"./FormFieldControl.b614070a.js";import{F}from"./FieldText.6d44809e.js";import{A as me}from"./AddIcon.159dfaf4.js";import{F as J}from"./FieldCustom.5b6685a5.js";import{G as pe,a as he}from"./useGetPrevPageParam.cb1386c2.js";import{u as ge}from"./useDebounce.b8118708.js";import{u as be,a as fe}from"./useSelectDataMapper.6391f061.js";import{S as Se}from"./select.0fe29549.js";import{T as ke}from"./index.esm.2ca9b441.js";import{I as Pe,B as k}from"./index.esm.780dcd2c.js";import{a as qe}from"./aoaToTree.b87a9c87.js";import{u as T,E as A}from"./useError.46aba7e3.js";import{o as B,c as L}from"./uiActions.0615ad97.js";import{C as K}from"./ConfirmDelete.bb641ee2.js";import{S as ve}from"./SaveIcon.2cbae624.js";import{f as Ie}from"./index.esm.b22a74c4.js";import{F as Ce}from"./FieldSelect.70d2789f.js";import{F as ye}from"./FieldSwitch.781e4b70.js";import{T as _e,a as ze,b as j}from"./index.esm.ad9d805c.js";import"./ArrowLeftIcon.0c9057ff.js";import"./index.esm.17aaa28e.js";import"./index.238261e4.js";import"./FilterIcon.698af641.js";import"./index.esm.f3b9d19a.js";import"./slicedToArray.556cd5c1.js";import"./ErrorEmpty.d1acacce.js";import"./Pagination.5113db8a.js";import"./ExpandLeftIcon.52c60c0f.js";import"./useTranslation.d56b7bba.js";import"./SearchInput.7f0274ff.js";import"./objectWithoutPropertiesLoose.2d2ba74a.js";import"./inheritsLoose.cba8c0e3.js";const Me=H.forwardRef(({name:a,onChange:n,onBlur:r,value:c,placeholder:l},g)=>{const[s,S]=x.exports.useState(""),C=ge(s,1e3),{fetchNextPage:y,hasNextPage:v,isError:I,isSuccess:m,isLoading:M,data:P,isFetchingNextPage:i}=be(["fetch_select_menus",C,c],({pageParam:p=1})=>ce({current:p,search:C,value:c==null?void 0:c.value,pageSize:15}),{getNextPageParam:p=>pe(p),getPreviousPageParam:p=>he(p)}),N=fe({isSuccess:m,data:P!=null?P:{pages:[],pageParams:[]},key:"menus",append:[{label:"Root",value:0}],returnList:p=>({label:p==null?void 0:p.Name,value:p.id})});return e(Se,{name:a,ref:g,onChange:n,onBlur:r,value:c,onInputChange:S,isLoading:i||M,isClearable:!0,noOptionsMessage:({inputValue:p})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:p})=>d(X,{children:[d("div",{children:['Mencari "',p,'"']}),M&&e(ae,{size:"xs",width:"100%",isIndeterminate:!0}),I&&e("div",{children:"Error saat mencari data"})]}),options:N,placeholder:e(te,{noOfLines:[1],children:l}),closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{v&&y()},closeMenuOnSelect:!0})}),$e=()=>{const{control:a,formState:n}=G(),{fields:r,append:c,remove:l}=de({control:a,name:"menus",rules:{minLength:1}});return d(O,{gap:2,flexDirection:"column",children:[r&&r.length>0&&r.map((g,s)=>d(Q,{gap:3,templateColumns:{base:"repeat(1,1fr)",md:"repeat(4,1fr)"},children:[e(h,{children:e(f,{control:a,formState:n,label:"Nama",id:`menus.${s}.name`,name:`menus.${s}.name`,rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{})})}),e(h,{children:e(f,{control:a,formState:n,label:"Path",id:`menus.${s}.path`,name:`menus.${s}.path`,rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{})})}),e(h,{children:e(f,{control:a,formState:n,label:"Parent",id:`menus.${s}.parentId`,name:`menus.${s}.parentId`,rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(J,{children:e(Me,{})})})}),e(h,{children:e(ke,{label:"Hapus Pilihan",children:e(Pe,{"aria-label":"remove",icon:e(E,{fontSize:26}),variant:"outline",onClick:()=>{l(s)},border:"none"})})})]})),e(k,{size:"sm",mt:5,variant:"outline",leftIcon:e(me,{}),onClick:()=>{c({name:"",path:""})},children:"Tambah menu"})]})},je=async a=>(await _.get(`/actions/menu/${a}`)).data,De=async({pageSize:a,current:n,search:r,usingActive:c=!1,value:l})=>{const g=r&&r!=""?`&search=${r}`:"",s=l?`&value=${l}`:"";return(await _.get(`/actions/paginated?using_active=${c}&page=${n!=null?n:1}&page_size=${a!=null?a:10}`+g+s)).data},Ke=async({data:a=[]})=>(await _.post("/actions/create-bulk",{data:a})).data,He=async a=>(await _.delete(`/actions/${a}`)).data,Qe=async({ids:a})=>(await _.delete("/actions/bulk",{data:{ids:a}})).data,Ge=async({id:a,data:n})=>(await _.put(`/actions/${a}`,n)).data,Ue=H.forwardRef(({name:a,onChange:n,onBlur:r,value:c,placeholder:l,isMulti:g=!1},s)=>{const[S,C]=x.exports.useState(""),y=ge(S,1e3),{fetchNextPage:v,hasNextPage:I,isError:m,isSuccess:M,isLoading:P,data:i,isFetchingNextPage:N}=be(["fetch_select_actions",y,c],({pageParam:b=1})=>De({current:b,search:y,usingActive:!0,value:c==null?void 0:c.value,pageSize:15}),{getNextPageParam:b=>pe(b),getPreviousPageParam:b=>he(b)}),p=fe({isSuccess:M,data:i!=null?i:{pages:[],pageParams:[]},key:"actions",returnList:b=>({label:b.name,value:b.id})});return e(Se,{name:a,ref:s,onChange:n,onBlur:r,value:c,isMulti:g,onInputChange:C,isLoading:N||P,isClearable:!0,noOptionsMessage:({inputValue:b})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:b})=>d(X,{children:[d("div",{children:['Mencari "',b,'"']}),P&&e(ae,{size:"xs",width:"100%",isIndeterminate:!0}),m&&e("div",{children:"Error saat mencari data"})]}),options:p,placeholder:e(te,{noOfLines:[1],children:l}),closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{I&&v()},closeMenuOnSelect:!0})}),Ve=()=>{const{control:a,formState:n}=G();return d(Q,{gap:3,templateColumns:{base:"repeat(1,1fr)"},children:[e(h,{children:e(f,{control:a,formState:n,label:"Nama",id:"name",name:"name",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{})})}),e(h,{children:e(f,{control:a,formState:n,label:"Path",id:"path",name:"path",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{})})}),e(h,{children:e(f,{control:a,formState:n,label:"Parent",id:"parentId",name:"parentId",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(J,{children:e(Me,{})})})}),e(h,{children:e(f,{control:a,formState:n,label:"APIS",id:"apis",name:"apis",rules:{required:{value:!1,message:"Dibutuhkan"}},children:e(J,{children:e(Ue,{isMulti:!0})})})})]})},We=({detail:a,onSubmit:n,isLoading:r})=>{const{data:c,isLoading:l,isSuccess:g}=Y(["actions_by_menu",a.id],()=>je(a.id),{cacheTime:0,keepPreviousData:!1,staleTime:0});return d(X,{children:[l&&"Loading..",g&&d(U,{onSubmit:n,initialValues:{id:a.id,name:a.Name,path:a.path,parentId:{label:+a.ParentId>0?a.parent_name:"Root",value:a.ParentId},apis:c.data&&c.data.length>0?c.data.map(s=>({label:s.name,value:s.id})):[]},id:"form-menu",children:[e(q,{p:5,children:e(Ve,{})}),e(Ie,{children:e(k,{leftIcon:e(ve,{}),isLoading:r,type:"submit",children:"Submit"})})]})]})},we=()=>{var z,$,u;const{setPagination:a,searchValue:n,pagination:r,handleSearch:c}=ue(),[l,g]=x.exports.useState({}),s=ne(),S=se(),C=T(Ne),y=T(Be),v=T(Le),I=T(Oe),m=ie(),M=()=>{const t=Object.keys(l).map(o=>+o);v.mutate({ids:t},{onSuccess:o=>{m({status:"success",description:o.message,position:"top",title:"Success",isClosable:!0}),S.invalidateQueries(["menus_paginated"]),s(L()),g({})},onError:o=>A(o,m)})},P=()=>{s(B(e(K,{onDelete:M}),"Apakah kamu yakin ingin menghapus beberapa menu ini ?","sm"))},{data:i,isLoading:N,isSuccess:p}=Y(["menus_paginated",{searchValue:n,...r}],()=>ce({pageSize:r.pageSize+50,current:r.pageIndex+1,search:n}),{keepPreviousData:!1}),b=t=>{I.mutate({id:t.id,data:{name:t.name,path:t.path,parent_id:t.parentId.value,apis:t.apis&&t.apis.length>0?t.apis.map(o=>o.value):[]}},{onSuccess:o=>{m({status:"success",description:o.message,position:"top",title:"Success",isClosable:!0}),S.invalidateQueries(["menus_paginated"]),s(L())},onError:o=>A(o,m)})},V=t=>{s(B(e(We,{detail:t,onSubmit:b,isLoading:I.isLoading}),"Edit Menu","md"))},W=t=>{y.mutate(t,{onSuccess:o=>{m({status:"success",description:o.message,position:"top",title:"Success",isClosable:!0}),S.invalidateQueries(["menus_paginated"]),s(L())},onError:o=>A(o,m)})},w=t=>{s(B(e(K,{onDelete:()=>W(t)}),"Apakah kamu yakin ingin menghapus menu ini ?","sm"))},ee=H.useMemo(()=>[{id:"checkbox",...re({useCheckbox:!0})},{id:"No",header:"No",accessorFn:(t,o)=>o+1},{id:"Name",header:"Name",accessorKey:"Name"},{id:"Path",header:"Path",accessorKey:"path"},{id:"Parent",header:"Parent",accessorKey:"parent_name"},{id:"Action",header:"Action",cell:({row:t})=>e(x.exports.Fragment,{children:d(O,{gap:2,alignItems:"center",children:[e(k,{size:"sm",leftIcon:e(oe,{}),variant:"outline",onClick:()=>V(t.original),children:"Edit"}),e(k,{size:"sm",onClick:()=>w(t.original.id),leftIcon:e(E,{}),colorScheme:"red",children:"Delete"})]})})}],[]);return d(O,{gap:5,flexDirection:"column",children:[e(U,{onSubmit:t=>{let o=t.menus.map(D=>({name:D.name,path:D.path,parent_id:D.parentId.value}));C.mutate({data:o},{onSuccess:D=>{m({status:"success",description:D.message,position:"top",title:"Success",isClosable:!0}),S.invalidateQueries(["menus_paginated"])},onError:D=>A(D,m)})},id:"form-menus",children:d(Z,{x:6,children:[e($e,{}),e(k,{type:"submit",size:"md",mt:5,w:"100%",children:"Submit"})]})}),e(le,{enableResizeColumn:!1,useSearchInput:!0,loading:N,onSearch:c,leftFilter:e(q,{display:{base:"none",md:"block"},children:d(k,{leftIcon:e(E,{}),colorScheme:"red",onClick:P,isLoading:v.isLoading,disabled:Boolean(Object.keys(l).length<1),children:["Delete ",Object.keys(l).length," data"]})}),bottomFilter:e(q,{display:{base:"block",md:"none"},children:d(k,{leftIcon:e(E,{}),colorScheme:"red",size:"xs",onClick:P,isLoading:v.isLoading,disabled:Boolean(Object.keys(l).length<1),children:["Delete ",Object.keys(l).length," data"]})}),rowKey:(t,o,D)=>t==null?void 0:t.id,onChangeTable:a,pagination:{pageIndex:Number((z=i==null?void 0:i.page)!=null?z:0)-1,pageSize:Number(($=i==null?void 0:i.page_size)!=null?$:10)},pageCount:Number((u=i==null?void 0:i.page_count)!=null?u:0),onCheckboxChange:g,rowSelectionProps:l,totalRecords:i==null?void 0:i.total,canExpand:t=>t.original.children?t.original.children.length>0:!1,getSubRows:t=>(t==null?void 0:t.children)||[],data:p?qe("id","ParentId",i==null?void 0:i.menus,0):[],columns:ee})]})},Re=()=>{const{control:a,formState:n}=G(),{fields:r,append:c,remove:l}=de({control:a,name:"apis",rules:{minLength:1}});return d(O,{gap:2,flexDirection:"column",children:[r&&r.length>0&&r.map((g,s)=>d(Q,{gap:3,templateColumns:{base:"repeat(1,1fr)",md:"repeat(5,1fr)"},children:[e(h,{children:e(f,{control:a,formState:n,label:"Nama",id:`apis.${s}.name`,name:`apis.${s}.name`,rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{})})}),e(h,{children:e(f,{control:a,formState:n,label:"Path",id:`apis.${s}.path`,name:`apis.${s}.path`,rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{})})}),e(h,{children:e(f,{control:a,formState:n,label:"Method",id:`apis.${s}.method`,name:`apis.${s}.method`,rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(Ce,{options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"},{label:"DELETE",value:"DELETE"},{label:"OPTIONS",value:"OPTIONS"}]})})}),e(h,{children:e(f,{control:a,formState:n,label:"Default",id:`apis.${s}.default`,name:`apis.${s}.default`,rules:{required:{value:!1,message:"Dibutuhkan"}},children:e(ye,{})})}),e(h,{children:e(ke,{label:"Hapus Pilihan",children:e(Pe,{"aria-label":"remove",icon:e(E,{fontSize:26}),variant:"outline",onClick:()=>{l(s)},border:"none"})})})]})),e(k,{size:"sm",mt:5,variant:"outline",leftIcon:e(me,{}),onClick:()=>{c({name:"",path:"",method:null,default:!1})},children:"Tambah API"})]})},Je=()=>{const{control:a,formState:n}=G();return d(Q,{gap:3,templateColumns:{base:"repeat(1,1fr)"},children:[e(h,{children:e(f,{control:a,formState:n,label:"Nama",id:"name",name:"name",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{})})}),e(h,{children:e(f,{control:a,formState:n,label:"Path",id:"path",name:"path",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(F,{})})}),e(h,{children:e(f,{control:a,formState:n,label:"Method",id:"method",name:"method",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(Ce,{options:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"},{label:"DELETE",value:"DELETE"},{label:"OPTIONS",value:"OPTIONS"}]})})}),e(h,{children:e(f,{control:a,formState:n,label:"Default",id:"default",name:"default",rules:{required:{value:!1,message:"Dibutuhkan"}},children:e(ye,{})})})]})},Xe=({detail:a,onSubmit:n,isLoading:r})=>d(U,{onSubmit:n,initialValues:{id:a.id,name:a.name,path:a.api,method:{label:a.method,value:a.method},default:a.default},id:"form-menu",children:[e(q,{p:5,children:e(Je,{})}),e(Ie,{children:e(k,{leftIcon:e(ve,{}),isLoading:r,type:"submit",children:"Submit"})})]}),Ye=()=>{var R,z,$;const{setPagination:a,searchValue:n,pagination:r,handleSearch:c}=ue(),[l,g]=x.exports.useState({}),s=ne(),S=se(),C=T(Ke),y=T(He),v=T(Qe),I=T(Ge),m=ie(),M=()=>{const u=Object.keys(l).map(t=>+t);v.mutate({ids:u},{onSuccess:t=>{m({status:"success",description:t.message,position:"top",title:"Success",isClosable:!0}),S.invalidateQueries(["actions_paginated"]),s(L()),g({})},onError:t=>A(t,m)})},P=()=>{s(B(e(K,{onDelete:M}),"Apakah kamu yakin ingin menghapus beberapa API ini ?","sm"))},{data:i,isLoading:N}=Y(["actions_paginated",{searchValue:n,...r}],()=>De({pageSize:r.pageSize,current:r.pageIndex+1,search:n}),{keepPreviousData:!1}),p=u=>{I.mutate({id:u.id,data:{name:u.name,path:u.path,method:u.method.value,default:u.default}},{onSuccess:t=>{m({status:"success",description:t.message,position:"top",title:"Success",isClosable:!0}),S.invalidateQueries(["actions_paginated"]),s(L())},onError:t=>A(t,m)})},b=u=>{s(B(e(Xe,{detail:u,onSubmit:p,isLoading:I.isLoading}),"Edit API","md"))},V=u=>{y.mutate(u,{onSuccess:t=>{m({status:"success",description:t.message,position:"top",title:"Success",isClosable:!0}),S.invalidateQueries(["actions_paginated"]),s(L())},onError:t=>A(t,m)})},W=u=>{s(B(e(K,{onDelete:()=>V(u)}),"Apakah kamu yakin ingin menghapus menu ini ?","sm"))},w=H.useMemo(()=>[{id:"checkbox",...re({useCheckbox:!0})},{id:"No",header:"No",accessorFn:(u,t)=>t+1},{id:"Name",header:"Name",accessorKey:"name"},{id:"Path",header:"Path",accessorKey:"api"},{id:"Method",header:"Method",accessorKey:"method"},{id:"Default",header:"Default",accessorKey:"default"},{id:"Action",header:"Action",cell:({row:u})=>e(x.exports.Fragment,{children:d(O,{gap:2,alignItems:"center",children:[e(k,{size:"sm",leftIcon:e(oe,{}),variant:"outline",onClick:()=>b(u.original),children:"Edit"}),e(k,{size:"sm",onClick:()=>W(u.original.id),leftIcon:e(E,{}),colorScheme:"red",children:"Delete"})]})})}],[]);return d(O,{gap:5,flexDirection:"column",children:[e(U,{onSubmit:u=>{let t=u.apis.map(o=>({name:o.name,path:o.path,method:o.method.value,default:o.default}));C.mutate({data:t},{onSuccess:o=>{m({status:"success",description:o.message,position:"top",title:"Success",isClosable:!0}),S.invalidateQueries(["actions_paginated"])},onError:o=>A(o,m)})},id:"form-actions",children:d(Z,{x:6,children:[e(Re,{}),e(k,{type:"submit",size:"md",mt:5,w:"100%",children:"Submit"})]})}),e(le,{enableResizeColumn:!1,useSearchInput:!0,loading:N,onSearch:c,leftFilter:e(q,{display:{base:"none",md:"block"},children:d(k,{leftIcon:e(E,{}),colorScheme:"red",onClick:P,isLoading:v.isLoading,disabled:Boolean(Object.keys(l).length<1),children:["Delete ",Object.keys(l).length," data"]})}),bottomFilter:e(q,{display:{base:"block",md:"none"},children:d(k,{leftIcon:e(E,{}),colorScheme:"red",size:"xs",onClick:P,isLoading:v.isLoading,disabled:Boolean(Object.keys(l).length<1),children:["Delete ",Object.keys(l).length," data"]})}),rowKey:(u,t,o)=>u==null?void 0:u.id,onChangeTable:a,pagination:{pageIndex:Number((R=i==null?void 0:i.page)!=null?R:0)-1,pageSize:Number((z=i==null?void 0:i.page_size)!=null?z:10)},pageCount:Number(($=i==null?void 0:i.page_count)!=null?$:0),onCheckboxChange:g,rowSelectionProps:l,totalRecords:i==null?void 0:i.total,data:i==null?void 0:i.actions,columns:w})]})},Ze={0:"",1:"",2:"",3:e(we,{}),4:e(Ye,{})},Qa=()=>{const[a,n]=x.exports.useState(0),r=Te(),[c]=Ae();return x.exports.useEffect(()=>{c.get("index")&&n(+c.get("index"))},[]),d(Ee,{title:"Settings",children:[e(xe,{label:"Settings",leftIcon:e(Fe,{fontSize:24}),children:e(_e,{index:a,onChange:l=>{n(l),r(`/management/settings?index=${l}`)},children:d(ze,{children:[e(j,{minW:"fit-content",children:"Application"}),e(j,{minW:"fit-content",children:"System"}),e(j,{minW:"fit-content",children:"Log"}),e(j,{minW:"fit-content",children:"Menus"}),e(j,{minW:"fit-content",children:"APIs"})]})})}),e(Z,{x:0,y:2,children:Ze[a]})]})};export{Qa as default};
