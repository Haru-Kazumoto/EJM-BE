import{S as p,U as b,V as f,W as h,X as v,Y as R,r as c,Z as M,$ as y}from"./index.0e24cb86.js";class m extends p{constructor(t,e){super(),this.client=t,this.setOptions(e),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.client.defaultMutationOptions(t),b(e,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this})}onUnsubscribe(){if(!this.listeners.length){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const e={listeners:!0};t.type==="success"?e.onSuccess=!0:t.type==="error"&&(e.onError=!0),this.notify(e)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t<"u"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:f(),e={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=e}notify(t){h.batch(()=>{if(this.mutateOptions){if(t.onSuccess){var e,i,u,s;(e=(i=this.mutateOptions).onSuccess)==null||e.call(i,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(u=(s=this.mutateOptions).onSettled)==null||u.call(s,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var n,a,o,l;(n=(a=this.mutateOptions).onError)==null||n.call(a,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(o=(l=this.mutateOptions).onSettled)==null||o.call(l,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(d=>{d(this.currentResult)})})}}function C(r,t,e){const i=v(r,t,e),u=R({context:i.context}),[s]=c.exports.useState(()=>new m(u,i));c.exports.useEffect(()=>{s.setOptions(i)},[s,i]);const n=M(c.exports.useCallback(o=>s.subscribe(h.batchCalls(o)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),a=c.exports.useCallback((o,l)=>{s.mutate(o,l).catch(x)},[s]);if(n.error&&y(s.options.useErrorBoundary,[n.error]))throw n.error;return{...n,mutate:a,mutateAsync:n.mutate}}function x(){}const E=(r,t)=>{var i,u;const e=r.response;r!=null&&r.data?t({title:(i=e==null?void 0:e.data)==null?void 0:i.message,status:"error",isClosable:!0,description:e.status>499?`req ID = ${(u=e==null?void 0:e.data)==null?void 0:u.request_id}`:null,position:"top"}):t({title:r==null?void 0:r.message,status:"error",isClosable:!0,position:"top"})};export{E,C as u};
