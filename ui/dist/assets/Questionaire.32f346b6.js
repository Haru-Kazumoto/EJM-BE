import{x as Re,z as ve,r as s,R as H,E as J,y as Ie,U as Me,a as e,an as Ne,j as p,B as Ae,T as I,F as T,D as de,aP as Le,aq as L,ap as ae,h as te,am as ze,a_ as Qe,a2 as Te,f as me,g as Be}from"./index.36e5c8e0.js";import{P as X}from"./PagePadding.1c9da704.js";import{D as ne}from"./Detailinformation.c7d0c3e1.js";import{C as je}from"./CommentsIcon.642429a2.js";import{F as Ge}from"./FileIcon.df2dfc6b.js";import{d as Oe}from"./dayjs.min.9509b64d.js";import{A as Ue,S as Ke}from"./index.esm.08b5451d.js";import{T as oe}from"./index.esm.f0e9f4ce.js";import{E as We}from"./EditIcon.d610a85a.js";import{u as Se,F as U,a as ye}from"./FormFieldControl.2c89898e.js";import{m as He,I as xe,B as se}from"./index.esm.c218bf3a.js";import{i as Ve,F as $e,a as Ye,I as Je,c as Xe,f as Ze,g as et}from"./index.esm.0f58bf09.js";import{t as tt}from"./index.238261e4.js";import{F as Z}from"./FieldTextArea.c0a8f160.js";import{c as nt,C as re,a as Ce}from"./index.esm.5ccae681.js";import{F as ot}from"./FieldText.f9548c3f.js";import{F as he}from"./FieldCustom.a580ac8f.js";import{u as ke,a as rt,G as Pe,b as Fe}from"./useSelectDataMapper.533313d1.js";import{u as at}from"./useDebounce.3f476afc.js";import{b as st}from"./usersActions.aa8d3840.js";import{S as it}from"./select.3b6ee5a4.js";import{S as lt,f as ct,h as ut,i as dt}from"./projectActions.d0ab648c.js";import{F as mt}from"./FilterIcon.742ec280.js";import{E as ht}from"./ErrorFetching.f00243df.js";import{u as pt,E as gt}from"./useError.dc03fcf4.js";import{A as ft}from"./ArrowLeftIcon.59577fdf.js";import{f as bt}from"./questionActions.2bac5b0b.js";import{E as pe}from"./ErrorEmpty.98242666.js";import"./slicedToArray.69cafb3e.js";import"./index.esm.4c8c0183.js";import"./index.esm.9df59221.js";import"./objectWithoutPropertiesLoose.2d2ba74a.js";import"./useTranslation.7b5c047c.js";var vt=(...t)=>t.filter(Boolean).join(" ");function ge(t){const o=typeof t;return t!=null&&(o==="object"||o==="function")&&!Array.isArray(t)}var _=t=>t?"":void 0,ee=t=>t?!0:void 0;function R(...t){return function(n){t.some(r=>(r==null||r(n),n==null?void 0:n.defaultPrevented))}}function St(...t){return function(n){t.forEach(r=>{r==null||r(n)})}}function yt(t,o){const n={},r={};for(const[a,c]of Object.entries(t))o.includes(a)?n[a]=c:r[a]=c;return[n,r]}function xt(t){return t&&ge(t)&&ge(t.target)}function Ct(t={}){const{onChange:o,value:n,defaultValue:r,name:a,isDisabled:c,isFocusable:m,isNative:h,...b}=t,[l,C]=s.exports.useState(r||""),g=typeof n<"u",k=g?n:l,S=s.exports.useRef(null),F=s.exports.useCallback(()=>{const u=S.current;if(!u)return;let f="input:not(:disabled):checked";const q=u.querySelector(f);if(q){q.focus();return}f="input:not(:disabled)";const P=u.querySelector(f);P==null||P.focus()},[]),y=`radio-${s.exports.useId()}`,x=a||y,A=s.exports.useCallback(u=>{const f=xt(u)?u.target.value:u;g||C(f),o==null||o(String(f))},[o,g]),K=s.exports.useCallback((u={},f=null)=>({...u,ref:He(f,S),role:"radiogroup"}),[]),N=s.exports.useCallback((u={},f=null)=>({...u,ref:f,name:x,[h?"checked":"isChecked"]:k!=null?u.value===k:void 0,onChange(P){A(P)},"data-radiogroup":!0}),[h,x,A,k]);return{getRootProps:K,getRadioProps:N,name:x,ref:S,focus:F,setValue:C,value:k,onChange:A,isDisabled:c,isFocusable:m,htmlProps:b}}var[kt,we]=Re({name:"RadioGroupContext",strict:!1}),_e=ve((t,o)=>{const{colorScheme:n,size:r,variant:a,children:c,className:m,isDisabled:h,isFocusable:b,...l}=t,{value:C,onChange:g,getRootProps:k,name:S,htmlProps:F}=Ct(l),M=s.exports.useMemo(()=>({name:S,size:r,onChange:g,colorScheme:n,value:C,variant:a,isDisabled:h,isFocusable:b}),[S,r,g,n,C,a,h,b]);return H.createElement(kt,{value:M},H.createElement(J.div,{...k(F,o),className:vt("chakra-radio-group",m)},c))});_e.displayName="RadioGroup";var Pt={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function Ft(t={}){const{defaultChecked:o,isChecked:n,isFocusable:r,isDisabled:a,isReadOnly:c,isRequired:m,onChange:h,isInvalid:b,name:l,value:C,id:g,"data-radiogroup":k,"aria-describedby":S,...F}=t,M=`radio-${s.exports.useId()}`,y=Ve(),A=!!we()||!!k;let N=!!y&&!A?y.id:M;N=g!=null?g:N;const u=a!=null?a:y==null?void 0:y.isDisabled,f=c!=null?c:y==null?void 0:y.isReadOnly,q=m!=null?m:y==null?void 0:y.isRequired,P=b!=null?b:y==null?void 0:y.isInvalid,[W,E]=s.exports.useState(!1),[z,B]=s.exports.useState(!1),[j,G]=s.exports.useState(!1),[V,Q]=s.exports.useState(!1),[Y,i]=s.exports.useState(Boolean(o)),v=typeof n<"u",w=v?n:Y;s.exports.useEffect(()=>tt(E),[]);const $=s.exports.useCallback(d=>{if(f||u){d.preventDefault();return}v||i(d.target.checked),h==null||h(d)},[v,u,f,h]),D=s.exports.useCallback(d=>{d.key===" "&&Q(!0)},[Q]),ie=s.exports.useCallback(d=>{d.key===" "&&Q(!1)},[Q]),Ee=s.exports.useCallback((d={},O=null)=>({...d,ref:O,"data-active":_(V),"data-hover":_(j),"data-disabled":_(u),"data-invalid":_(P),"data-checked":_(w),"data-focus":_(z),"data-focus-visible":_(z&&W),"data-readonly":_(f),"aria-hidden":!0,onMouseDown:R(d.onMouseDown,()=>Q(!0)),onMouseUp:R(d.onMouseUp,()=>Q(!1)),onMouseEnter:R(d.onMouseEnter,()=>G(!0)),onMouseLeave:R(d.onMouseLeave,()=>G(!1))}),[V,j,u,P,w,z,f,W]),{onFocus:le,onBlur:ce}=y!=null?y:{},De=s.exports.useCallback((d={},O=null)=>{const ue=u&&!r;return{...d,id:N,ref:O,type:"radio",name:l,value:C,onChange:R(d.onChange,$),onBlur:R(ce,d.onBlur,()=>B(!1)),onFocus:R(le,d.onFocus,()=>B(!0)),onKeyDown:R(d.onKeyDown,D),onKeyUp:R(d.onKeyUp,ie),checked:w,disabled:ue,readOnly:f,required:q,"aria-invalid":ee(P),"aria-disabled":ee(ue),"aria-required":ee(q),"data-readonly":_(f),"aria-describedby":S,style:Pt}},[u,r,N,l,C,$,ce,le,D,ie,w,f,q,P,S]);return{state:{isInvalid:P,isFocused:z,isChecked:w,isActive:V,isHovered:j,isDisabled:u,isReadOnly:f,isRequired:q},getCheckboxProps:Ee,getInputProps:De,getLabelProps:(d={},O=null)=>({...d,ref:O,onMouseDown:R(d.onMouseDown,fe),onTouchStart:R(d.onTouchStart,fe),"data-disabled":_(u),"data-checked":_(w),"data-invalid":_(P)}),getRootProps:(d,O=null)=>({...d,ref:O,"data-disabled":_(u),"data-checked":_(w),"data-invalid":_(P)}),htmlProps:F}}function fe(t){t.preventDefault(),t.stopPropagation()}var qe=ve((t,o)=>{var G;const n=we(),{onChange:r,value:a}=t,c=Ie("Radio",{...n,...t}),m=Me(t),{spacing:h="0.5rem",children:b,isDisabled:l=n==null?void 0:n.isDisabled,isFocusable:C=n==null?void 0:n.isFocusable,inputProps:g,...k}=m;let S=t.isChecked;(n==null?void 0:n.value)!=null&&a!=null&&(S=n.value===a);let F=r;(n==null?void 0:n.onChange)&&a!=null&&(F=St(n.onChange,r));const M=(G=t==null?void 0:t.name)!=null?G:n==null?void 0:n.name,{getInputProps:y,getCheckboxProps:x,getLabelProps:A,getRootProps:K,htmlProps:N}=Ft({...k,isChecked:S,isFocusable:C,isDisabled:l,onChange:F,name:M}),[u,f]=yt(N,Ne),q=x(f),P=y(g,o),W=A(),E=Object.assign({},u,K()),z={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...c.container},B={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...c.control},j={userSelect:"none",marginStart:h,...c.label};return H.createElement(J.label,{className:"chakra-radio",...E,__css:z},e("input",{className:"chakra-radio__input",...P}),H.createElement(J.span,{className:"chakra-radio__control",...q,__css:B}),b&&H.createElement(J.span,{className:"chakra-radio__label",...W,__css:j},b))});qe.displayName="Radio";const wt=({onClick:t,active:o,question_title:n,answered_at:r,answered_by_name:a,answered_by_profile:c})=>p(s.exports.Fragment,{children:[p(Ae,{p:3,_hover:{backgroundColor:"rgba(104,211,145,0.35)"},onClick:t,backgroundColor:o?"rgba(104,211,145,0.50)":"transparent",cursor:"pointer",children:[e(I,{fontSize:15,fontWeight:"medium",noOfLines:2,children:n}),p(T,{alignItems:"center",children:[e(ne,{label:e(I,{fontSize:11,children:"Answered By"}),direction:"column",value:p(T,{gap:2,alignItems:"center",children:[e(Ue,{size:"xs",objectFit:"cover",name:a!=null?a:"",src:c?`/api/v1/profiles/${c}`:"/default-image.jpg"}),e(I,{fontSize:12,children:a!=null?a:""})]})}),e(ne,{label:e(I,{fontSize:11,children:"Answered At"}),direction:"column",value:r?e(I,{fontSize:12,children:Oe(r).fromNow()}):"-"})]}),e(de,{my:1}),p(T,{alignItems:"center",gap:2,children:[e(oe,{label:"0 Comments",children:p(T,{gap:1,children:[e(je,{fontSize:20}),e(I,{fontSize:13,opacity:.5,children:"0"})]})}),e(oe,{label:"2 Attachments",children:p(T,{gap:1,children:[e(Ge,{fontSize:20}),e(I,{fontSize:13,opacity:.5,children:"0"})]})})]})]}),e(de,{})]}),_t=({id:t,placeholder:o,label:n,isRequired:r=!1,errorMessage:a,type:c="text",leftElement:m,rightElement:h,isInvalid:b=!1,formState:l,direction:C="row",options:g,...k})=>p($e,{isRequired:r,isInvalid:b,children:[n&&n!==""?e(Ye,{htmlFor:t,children:n}):null,p(Je,{children:[m&&e(Xe,{pointerEvents:"none",alignItems:"center",children:m}),e(_e,{...k,children:e(Le,{direction:C,children:g&&g.length>0?g.map(S=>e(qe,{value:S.value,children:S.label})):null})}),h&&e(Ze,{alignItems:"center",children:h})]}),e(et,{children:a})]}),qt=({options:t})=>{const{control:o,formState:n,watch:r}=Se(),a=r("choosed"),c=s.exports.useMemo(()=>{if(t&&t.length>0){const m=t.find(h=>h.name===a);return e(s.exports.Fragment,{children:m&&m.conditions&&m.conditions.length>0&&m.conditions.map((h,b)=>e(L,{children:e(U,{control:o,formState:n,name:h.name,label:h.name,id:h.name,rules:{required:{value:h.is_mandatory,message:"Dibutuhkan"}},children:e(Z,{rows:3})})}))})}else return null},[a,t]);return p(ae,{templateColumns:"repeat(1,1fr)",gap:5,children:[t&&t.length>0?e(L,{children:e(U,{control:o,formState:n,name:"choosed",id:"choosed",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(_t,{options:t.map(m=>({label:m.name,value:m.name})),direction:"column"})})}):e(L,{children:e(U,{control:o,formState:n,name:"description",id:"description",label:"Deskripsi",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(Z,{rows:3})})}),c,e(L,{children:e(U,{control:o,formState:n,name:"keterangan",label:"Keterangan",id:"keterangan",children:e(Z,{rows:5})})})]})},Et=({editable:t=!1,data:o,onAnswer:n,initialValues:r={choosed:null,keterangan:null,attachment:void 0},isLoading:a=!1,getDetailLoading:c=!1})=>p(s.exports.Fragment,{children:[e(nt,{children:p(T,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",children:[e(I,{fontWeight:"medium",fontSize:19,children:o.name}),t?e(oe,{label:"Edit Question",children:e(xe,{"aria-label":"Edit",variant:"unstyled",icon:e(We,{fontSize:28,color:"yellow.400"})})}):null]})}),p(X,{x:6,y:6,children:[c&&"Loading...",!c&&p(ye,{onSubmit:n,id:"form-question",initialValues:r,children:[e(qt,{options:o.answers}),e(se,{type:"submit",mt:5,isLoading:a,children:"Submit"})]})]})]}),Dt=H.forwardRef(({name:t,onChange:o,onBlur:n,value:r,placeholder:a},c)=>{const[m,h]=s.exports.useState(""),b=at(m,1e3),{fetchNextPage:l,hasNextPage:C,isError:g,isSuccess:k,isLoading:S,data:F,isFetchingNextPage:M}=ke(["fetch_select_users",b,r],({pageParam:x=1})=>st({current:x,search:b,value:r==null?void 0:r.value,pageSize:15}),{getNextPageParam:x=>Pe(x),getPreviousPageParam:x=>Fe(x)}),y=rt({isSuccess:k,data:F!=null?F:{pages:[],pageParams:[]},key:"users",returnList:x=>({label:`${x.username} - ${x.full_name}`,value:x.id})});return e(it,{name:t,ref:c,onChange:o,onBlur:n,value:r,onInputChange:h,isLoading:M||S,isClearable:!0,noOptionsMessage:({inputValue:x})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:x})=>p(te,{children:[p("div",{children:['Mencari "',x,'"']}),S&&e(ze,{size:"xs",width:"100%",isIndeterminate:!0}),g&&e("div",{children:"Error saat mencari data"})]}),options:y,placeholder:e(I,{noOfLines:[1],children:a}),closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{C&&l()},closeMenuOnSelect:!0})}),Rt=()=>{const{control:t,formState:o}=Se();return p(ae,{templateColumns:{base:"repeat(1,1fr)",md:"repeat(3,1fr)"},gap:4,children:[e(L,{children:e(U,{placeholder:"-- Cari Pertanyaan --",control:t,name:"question_search",formState:o,id:"question_search",children:e(ot,{})})}),e(L,{children:e(U,{placeholder:"-- Pilih Status Pertanyaan --",control:t,name:"question_status",formState:o,id:"question_status",children:e(he,{children:e(lt,{type_:"QUESTION_STATUS"})})})}),e(L,{children:e(U,{placeholder:"-- Pilih Dijawab Siapa --",control:t,name:"question_answered_by",formState:o,id:"question_answered_by",children:e(he,{children:e(Dt,{})})})})]})},It=({onSubmit:t})=>e(re,{children:p(Ce,{children:[e(I,{fontWeight:"medium",mb:3,children:"Filter data"}),p(ye,{onSubmit:t,id:"form-questionaire",children:[e(Rt,{}),e(se,{leftIcon:e(mt,{}),mt:5,size:"sm",type:"submit",children:"Filter"})]})]})}),be="DESCRIPTION_ANSWERED",fn=s.exports.forwardRef(({structuresId:t,projectId:o,editable:n=!1},r)=>{var Y;const[a,c]=s.exports.useState(t),[m,h]=s.exports.useState(o),[b]=Qe(),[l,C]=s.exports.useState(null),[g,k]=s.exports.useState({question_answered_by:null,question_search:null,question_status:null});s.exports.useImperativeHandle(r,()=>({removeFilterQuestions(){k({question_answered_by:null,question_search:null,question_status:null}),C(null)}}));const S=Te(),F=pt(ct);s.exports.useEffect(()=>{h(o!=null?o:+b.get("projectId")),c(t!=null?t:b.get("structureId"))},[t,b.get("structureId"),o,b.get("projectId")]);const{isSuccess:M,isLoading:y,isError:x,data:A}=me(["detail_structure",t,o],()=>ut({structureId:t,projectId:o}),{enabled:!!t&&!!o}),{isSuccess:K,isLoading:N,isError:u,refetch:f,data:q,hasNextPage:P,fetchNextPage:W}=ke(["questions",a,m,{...g}],({pageParam:i=1})=>dt({id:a,prjId:m,current:i,answered_by:g.question_answered_by,status_answered:g.question_status,search:g.question_search,pageSize:15}),{enabled:!!a,getNextPageParam:i=>Pe(i),getPreviousPageParam:i=>Fe(i)}),{data:E,isLoading:z,isSuccess:B}=me(["answered_question",l==null?void 0:l.id],()=>bt(l==null?void 0:l.id),{cacheTime:0,staleTime:0,enabled:!!(l!=null&&l.id)}),j=s.exports.useMemo(()=>{let i={};return B?(E.data.conditions&&E.data.conditions.map(v=>{i[v.label]=v.value}),E.data.answer_label===be?{description:E.data.description,keterangan:E.data.note,attachment:void 0,...i}:{choosed:E.data.answer_label,keterangan:E.data.note,attachment:void 0,...i}):{choosed:null,keterangan:null,attachment:void 0}},[B,E]),G=i=>{var v,w;C(null),k({question_status:(v=i.question_status)==null?void 0:v.value,question_search:i.question_search,question_answered_by:(w=i.question_answered_by)==null?void 0:w.value})},V=i=>{var $;let v,w;i!=null&&i.choosed?(w=l.answers.find(D=>D.name===i.choosed),v=w.conditions.map(D=>({label:D.name,value:i==null?void 0:i[D.name]}))):v=null,F.mutate({answer:{conditions:v,keterangan:i.keterangan,label:($=i==null?void 0:i.choosed)!=null?$:be,value:w?w.value.toString():i.description},question_id:l.id},{onSuccess:D=>{S({position:"top",title:"Success",description:D.message,isClosable:!0}),C(null),f()},onError:D=>gt(D,S)})},Q=i=>{C(i)};return e(s.exports.Fragment,{children:u?e(ht,{}):p(s.exports.Fragment,{children:[p(X,{x:0,y:2,children:[y&&e(Ke,{w:"100%",h:100}),x&&e(I,{children:"Error Menampilkan Detail Struktur"}),M&&e(re,{children:e(Ce,{children:e(ne,{maxW:"100%",direction:"column",label:"Unit Kerja",value:A.data.name})})})]}),e(X,{x:0,y:2,children:e(It,{onSubmit:G})}),e(X,{x:0,y:3,children:e(re,{children:p(ae,{templateColumns:"repeat(5,1fr)",children:[p(L,{colSpan:{base:5,lg:l?2:5},display:{base:l?"none":"block",lg:"block"},borderRight:{base:0,lg:.5},borderStyle:"solid",borderColor:"grey.200",maxH:{lg:700},minH:{base:700},overflowY:{lg:"auto"},_dark:{borderColor:"grey.600"},children:[N&&e(Be,{}),K&&q.pages[0].questions&&((Y=q.pages[0].questions)==null?void 0:Y.length)>0?p(te,{children:[q.pages.map(i=>i.questions&&i.questions.length>0?e(te,{children:i.questions.map(v=>e(wt,{question_title:v.name,onClick:()=>Q(v),answered_at:v.answered_at,active:(l==null?void 0:l.id)===(v==null?void 0:v.id),answered_by_name:v.answered_by_name,answered_by_profile:v.answered_by_profile}))}):e(pe,{})),P&&e(T,{my:5,justifyContent:"center",children:e(se,{size:"sm",onClick:()=>W(),children:"Load More"})})]}):e(T,{alignItems:"center",justifyContent:"center",h:"100%",children:e(pe,{})})]}),l&&p(L,{colSpan:{base:l?5:0,lg:3},display:{base:l?"block":"none",lg:"block"},children:[e(xe,{"aria-label":"Comeback",display:{base:"block",lg:"none"},variant:"outline",onClick:()=>C(null),icon:e(ft,{}),ml:5,mt:5}),e(Et,{editable:n,data:l,onAnswer:V,initialValues:j,getDetailLoading:z,isLoading:F.isLoading})]})]})})})]})})});export{fn as default};
