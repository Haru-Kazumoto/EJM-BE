import{j as r,I as De,a as e,R as Ue,r as D,i as z,an as fe,T as k,d as R,e as B,Y as H,g as W,B as _,F as u,c as Ae,ar as J,as as I,aQ as ce,aR as de,aS as Re,u as Ve,D as Be,aT as He,aU as Oe,aV as Ke,h as ye,ao as xe}from"./index.0e24cb86.js";import{P as $e}from"./Page.b0ec3cd0.js";import{P as Ye}from"./PageHeader.55df2133.js";import{F as Ge,a as We,I as Je,c as Ze,f as Xe,g as et,P as tt}from"./PagePadding.f9f1bdac.js";import{A as he}from"./AddIcon.52f4e4fc.js";import{E as be}from"./EditIcon.0dd57a11.js";import{D as V}from"./Detailinformation.255e4d07.js";import{B as rt}from"./BuildingIcon.f5c2948f.js";import{C as nt,F as it}from"./FormFieldProject.0365416c.js";import{U as st}from"./UserIcon.accdbe28.js";import{d as te}from"./dayjs.min.de763c4f.js";import{r as at}from"./relativeTime.1fcc03b9.js";import{D as re}from"./DeleteIcon.85510701.js";import{E as ot}from"./EyeIcon.0d72bd0e.js";import{c as T,o as Q,a as Ee}from"./uiActions.408d82e2.js";import{S as ne}from"./SearchInput.6e0cefa2.js";import{a as Se,u as lt,b as ct,d as dt,c as ut,e as pt,f as mt,h as ht,i as gt,s as ft,j as bt,k as St,l as jt,m as vt,n as Ct}from"./projectActions.133a6b49.js";import{u as O}from"./useDebounce.f82902b3.js";import{u as K,a as Z,G as je,b as ve}from"./useSelectDataMapper.c05d958f.js";import{C as Ce}from"./ConfirmDelete.262b9563.js";import{u as Me,F as $,a as ie}from"./FormFieldControl.6d022860.js";import{S as _t}from"./SelectLookup.9c949968.js";import{S as ze}from"./select.f59423ba.js";import{F as ge}from"./FieldCustom.a890d568.js";import{S as _e}from"./SaveIcon.a38dc1b6.js";import{u as q,E as N}from"./useError.ed61bdd7.js";import{f as X,g as Pt}from"./index.esm.3048a115.js";import{B as U,I as F}from"./index.esm.726820fc.js";import{A as se,a as kt}from"./index.esm.ba2a2cc9.js";import{C as ae,c as oe,a as le,b as yt}from"./index.esm.6acc2bf5.js";import{T as w}from"./index.esm.008f63b2.js";import{S as Y}from"./index.esm.e1b3c63e.js";import{b as xt}from"./aoaToTree.b87a9c87.js";import{E as Fe}from"./ErrorFetching.2cd1a256.js";import{E as G}from"./ErrorEmpty.82811164.js";import{a as It,C as Pe}from"./index.esm.68da116c.js";import{g as Lt}from"./questionActions.28a337fa.js";import{F as Ie}from"./FieldText.629ceab0.js";import{v as Dt}from"./v4.c3af96ce.js";import{e as Ut}from"./usersActions.997728a2.js";import{L as At}from"./LogActivity.0fdd5bbf.js";import{E as Et}from"./ExpandRightIcon.0088b7a2.js";import{T as Mt,a as zt,b as ue,c as Ft,d as pe}from"./index.esm.362f1310.js";import"./ArrowLeftIcon.12227cb3.js";import"./index.esm.25501534.js";import"./FieldTextArea.eda53a25.js";import"./useTranslation.d6d641af.js";import"./slicedToArray.49cdadd5.js";import"./objectWithoutPropertiesLoose.2d2ba74a.js";import"./index.esm.9fed1f3b.js";import"./inheritsLoose.5105dba6.js";import"./index.238261e4.js";import"./CommentsIcon.7c801b68.js";const ee=({...t})=>r(De,{...t,children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 5C3 4.44772 3.44772 4 4 4H16C16.5523 4 17 4.44772 17 5C17 5.55228 16.5523 6 16 6H4C3.44772 6 3 5.55228 3 5Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 10C3 9.44772 3.44772 9 4 9H16C16.5523 9 17 9.44772 17 10C17 10.5523 16.5523 11 16 11H4C3.44772 11 3 10.5523 3 10Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 15C9 14.4477 9.44772 14 10 14H16C16.5523 14 17 14.4477 17 15C17 15.5523 16.5523 16 16 16H10C9.44772 16 9 15.5523 9 15Z",fill:"currentColor"})]}),Te=Ue.forwardRef(({name:t,onChange:a,onBlur:o,value:s,placeholder:p,projectId:m,isMulti:c=!1,prepend:b=[]},S)=>{const[h,l]=D.exports.useState(""),g=O(h,1e3),{fetchNextPage:C,hasNextPage:y,isError:d,isSuccess:x,isLoading:A,data:L}=K(["fetch_select_structure_by_project_primitive",g,m],({pageParam:i=1})=>Se({current:i,search:g,value:s==null?void 0:s.value,project:+m,pageSize:15}),{enabled:!!m,refetchOnMount:!1,refetchOnWindowFocus:!1,getNextPageParam:i=>je(i),getPreviousPageParam:i=>ve(i)}),j=Z({isSuccess:x,data:L!=null?L:{pages:[],pageParams:[]},key:"structures",prepend:b,returnList:i=>({label:i.name,value:i.uuid})});return e(ze,{name:t,ref:S,onChange:a,onBlur:o,value:s,isMulti:c,onInputChange:l,isLoading:A,isClearable:!0,noOptionsMessage:({inputValue:i})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:i})=>r(z,{children:[r("div",{children:['Mencari "',i,'"']}),A&&e(fe,{size:"xs",width:"100%",isIndeterminate:!0}),d&&e("div",{children:"Error saat mencari data"})]}),options:j,placeholder:e(k,{noOfLines:[1],children:p}),closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{y&&C()},closeMenuOnSelect:!0})}),we=({project_id:t})=>{const{control:a,formState:o}=Me();return r(z,{children:[e($,{control:a,name:"job",formState:o,id:"job",placeholder:"-- Pilih Pekerjaan --",rules:{required:{value:!0,message:"Dibutuhkan"},min:{value:1,message:"Dibutuhkan"}},children:e(ge,{children:e(_t,{type_:"PROJECT_JOB",isMulti:!0})})}),e($,{control:a,name:"unit_kerja",formState:o,id:"unit_kerja",placeholder:"-- Pilih Unit Kerja --",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(ge,{children:e(Te,{projectId:t,isMulti:!0})})})]})},Tt=({project_id:t,user_id:a})=>{const o=R(),s=B(),p=H(),m=q(lt),{data:c,isLoading:b,isError:S,isSuccess:h}=W(["detail_assigned_user",t,a],()=>ct({projectId:t,userId:a}),{enabled:!!t&&!!a,cacheTime:0,onError:g=>N(g,s)});return r(z,{children:[S&&e(_,{p:5,children:"Error"}),b&&e(_,{p:5,children:"Loading..."}),h&&r(ie,{onSubmit:g=>{const C=g.job.map(d=>d.value),y=g.unit_kerja.map(d=>d.value);m.mutate({userId:a,payload:{project_id:+t,job:C,structure_id:y}},{onSuccess:d=>{s({status:"success",title:"success",description:d.message,position:"top",isClosable:!0}),p.invalidateQueries(["project_detail"]),p.invalidateQueries(["users_assigned"]),o(T())},onError:d=>N(d,s)})},id:"form-edit-assign-user",initialValues:{job:c.data.job,unit_kerja:c.data.structures},children:[e(_,{p:5,children:e(u,{gap:5,flexDirection:"column",children:e(we,{project_id:t})})}),e(X,{children:r(u,{gap:5,children:[e(U,{variant:"outline",colorScheme:"red",size:"sm",onClick:()=>o(T()),children:"Cancel"}),e(U,{type:"submit",variant:"solid",isLoading:m.isLoading,size:"sm",leftIcon:e(_e,{}),children:"Submit"})]})})]})]})},Ne=({project_id:t})=>{const[a,o]=D.exports.useState();Ae();const s=R(),p=B(),m=H(),c=O(a,200),b=q(dt),{data:S,isLoading:h,isSuccess:l,isError:g,isFetchingNextPage:C,hasNextPage:y,fetchNextPage:d}=K(["assign_users_paginated",c,t],({pageParam:i})=>ut({pageSize:20,current:i,search:c,project_id:t})),x=i=>{b.mutate({id:i,projectId:+t},{onSuccess:P=>{p({status:"success",title:"Sukses",description:P.message,position:"top",isClosable:!0}),m.invalidateQueries(["project_detail"]),m.invalidateQueries(["users_assigned"]),s(T())},onError:P=>N(P,p)})},A=i=>{s(Q(e(Ce,{onDelete:()=>x(i)}),"Anda yakin ingin menghapus data ini ?","md"))},L=i=>{s(Q(e(Tt,{project_id:t,user_id:i}),"Edit User","md"))},j=Z({isSuccess:l,data:S!=null?S:{pages:[],pageParams:[]},key:"users",filterFn:i=>i.roleId!==1,returnList:i=>{var P,M;return r(u,{justifyContent:"space-between",alignItems:"center",children:[r(u,{gap:2,alignItems:"center",children:[e(se,{size:"xs",objectFit:"cover",name:(P=i.full_name)!=null?P:"",src:i.profile_pict?`/api/v1/profiles/${i.profile_pict}`:"/default-image.jpg"}),e(k,{fontSize:"sm",children:(M=i.full_name)!=null?M:""})]}),r(_,{children:[e(F,{"aria-label":"Edit Assigned User",fontSize:20,color:"yellow.500",variant:"link",onClick:()=>L(i.id),icon:e(be,{})}),e(F,{"aria-label":"Delete Assigned User",fontSize:20,color:"red.500",variant:"link",onClick:()=>A(i.id),icon:e(re,{})})]})]})}});return e(_,{p:5,children:r(u,{flexDirection:"column",gap:5,children:[e(ne,{onChange:i=>{i.preventDefault(),o(i.target.value)}}),g&&"Error Occured",h&&"Loading..",l&&r(u,{flexDirection:"column",gap:2,maxH:300,overflowY:"auto",children:[j,y&&e(U,{size:"sm",mt:2,onClick:()=>d(),isLoading:C,children:"Load More"})]})]})})};te.extend(at);const wt=({data:t,onDelete:a,onEdit:o})=>{const s=R(),p=()=>{s(Ee({component:e(Ne,{project_id:t.id}),title:"List Assigned User",size:"md"}))};return r(ae,{children:[e(oe,{children:r(u,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",children:[e(k,{fontWeight:"medium",fontSize:19,children:"Project Info"}),r(u,{alignItems:"center",gap:2,children:[e(w,{label:"Edit Project Info",children:e(F,{"aria-label":"Edit",variant:"unstyled",onClick:o,icon:e(be,{fontSize:28,color:"yellow.400"})})}),e(w,{label:"Delete Project",children:e(F,{"aria-label":"Delete",variant:"unstyled",onClick:a,icon:e(re,{fontSize:28,color:"red.400"})})})]})]})}),e(le,{children:r(J,{templateColumns:{base:"repeat(1,1fr)",md:"repeat(2,1fr)",xl:"repeat(3,1fr)"},gap:{base:5,md:2},children:[e(I,{children:e(V,{leftIcon:e(rt,{fontSize:21}),label:"Company",value:r(u,{gap:2,alignItems:"center",children:[e(se,{size:"xs",objectFit:"cover",name:t.company.name,src:t.company.profile_pict?`/api/v1/profiles/${t.company.profile_pict}`:"/default-image.jpg"}),e(k,{fontSize:12,children:t.company.name})]}),direction:"column"})}),e(I,{children:e(V,{leftIcon:e(ee,{fontSize:21}),label:"Project Type",direction:"column",value:t.select_project_type_label})}),e(I,{children:e(V,{leftIcon:e(ee,{fontSize:21}),label:"Project Status",direction:"column",value:t.select_status_label})}),e(I,{children:e(V,{leftIcon:e(ee,{fontSize:21}),label:"Project Code",direction:"column",value:t.project_code})}),e(I,{children:e(V,{leftIcon:e(nt,{fontSize:21}),label:"Due Date",direction:"column",value:r("div",{children:[e(k,{children:te(t.project_date).format("DD MMMM YYYY")}),r("small",{children:["(",te(t.project_date).fromNow(),")"]})]})})}),e(I,{children:e(V,{leftIcon:e(st,{fontSize:21}),label:"Assigned User",direction:"column",value:r(u,{gap:2,alignItems:"center",children:[e(k,{children:t.total_assigned_users.toString()}),e(w,{label:"Click to view Detail",children:e(F,{"aria-label":"Detail",variant:"link",onClick:p,icon:e(ot,{})})})]})})}),e(I,{colSpan:{base:0,xl:3},children:e(V,{leftIcon:e(ee,{fontSize:21}),label:"Description",direction:"column",value:t.description})})]})})]})},me=(t,a)=>{var o=t.toString(),s=o.replace(/[^,\d]/g,"").toString(),p=s.split(","),m=p[0].length%3,c=p[0].substr(0,m),b=p[0].substr(m).match(/\d{3}/gi);return b&&(c+=(m?".":"")+b.join(".")),c=p[1]!=null?c+","+p[1]:c,a==null?c:c?a+c+",-":""},Nt=({projectId:t})=>{const{data:a,isLoading:o,isSuccess:s}=W(["statisic_project",t],()=>pt({projectId:t}),{enabled:!!t});return r(ae,{children:[e(oe,{children:e(k,{fontWeight:"medium",fontSize:19,children:"Task Progress"})}),r(le,{children:[o&&r(J,{templateColumns:{base:"repeat(1,1fr)",xl:"repeat(3,1fr)"},gap:5,children:[e(I,{children:e(Y,{w:"100%",h:200})}),e(I,{children:e(Y,{w:"100%",h:200})}),e(I,{children:e(Y,{w:"100%",h:200})})]}),s&&r(J,{templateColumns:{base:"repeat(1,1fr)",xl:"repeat(3,1fr)"},gap:5,children:[e(I,{children:r(u,{flexDirection:"column",alignItems:"center",children:[r("div",{style:{marginBottom:2},children:[e(k,{children:"Questionaire"}),r("small",{children:["( ",me(a.data.current_filled_questions)," /"," ",me(a.data.total_questions)," )"]})]}),e(_,{children:e(ce,{value:a.data.total_questions>0?a.data.current_filled_questions/a.data.total_questions*100:0,color:"green.400",size:150,children:r(de,{children:[me(a.data.total_questions>0?Math.round(a.data.current_filled_questions/a.data.total_questions*100):0),"%"]})})})]})}),e(I,{children:r(u,{flexDirection:"column",alignItems:"center",children:[r("div",{style:{marginBottom:2},children:[e(k,{children:"Inventory"}),e("small",{children:"( 0 / 0 )"})]}),e(_,{children:e(ce,{value:0,color:"green.400",size:150,children:e(de,{children:"0%"})})})]})}),e(I,{children:r(u,{flexDirection:"column",alignItems:"center",children:[r("div",{style:{marginBottom:2},children:[e(k,{children:"Volumes"}),e("small",{children:"( 0 / 0 )"})]}),e(_,{children:e(ce,{value:0,color:"green.400",size:150,children:e(de,{children:"0%"})})})]})})]})]})]})},Qe=({id:t,placeholder:a,label:o,isRequired:s=!1,errorMessage:p,type:m="text",leftElement:c,rightElement:b,isInvalid:S=!1,formState:h,direction:l="row",options:g,...C})=>r(Ge,{isRequired:s,isInvalid:S,children:[o&&o!==""?e(We,{htmlFor:t,children:o}):null,r(Je,{children:[c&&e(Ze,{pointerEvents:"none",alignItems:"center",children:c}),e(It,{...C,children:e(Re,{direction:l,children:g&&g.length>0?g.map(y=>e(Pe,{value:y.value,children:y.label})):null})}),b&&e(Xe,{alignItems:"center",children:b})]}),e(et,{children:p})]}),Qt=Ue.forwardRef(({name:t,onChange:a,onBlur:o,value:s,placeholder:p,isMulti:m=!1},c)=>{const[b,S]=D.exports.useState(""),h=O(b,1e3),{fetchNextPage:l,hasNextPage:g,isError:C,isSuccess:y,isLoading:d,data:x,isFetchingNextPage:A}=K(["fetch_select_question_templates",h],({pageParam:j=1})=>Lt({current:j,search:h,value:s==null?void 0:s.value,using_active:!0,pageSize:15}),{getNextPageParam:j=>je(j),getPreviousPageParam:j=>ve(j)}),L=Z({isSuccess:y,data:x!=null?x:{pages:[],pageParams:[]},key:"question_templates",returnList:j=>({label:j.name,value:j.id})});return e(ze,{name:t,ref:c,onChange:a,onBlur:o,isMulti:m,value:s,onInputChange:S,isLoading:A||d,isClearable:!0,noOptionsMessage:({inputValue:j})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:j})=>r(z,{children:[r("div",{children:['Mencari "',j,'"']}),d&&e(fe,{size:"xs",width:"100%",isIndeterminate:!0}),C&&e("div",{children:"Error saat mencari data"})]}),options:L,placeholder:p,closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{g&&l()},closeMenuOnSelect:!0})}),qt=({projectId:t})=>{const[a,o]=D.exports.useState(),[s,p]=D.exports.useState([]),[m,c]=D.exports.useState(null),b=B(),S=R(),h=O(a,200),l=q(mt),g=H(),{data:C,isLoading:y,isSuccess:d,isError:x,hasNextPage:A,fetchNextPage:L}=K(["assign_project_structures",t,h],({pageParam:n})=>Se({pageSize:20,current:n,search:h,project:+t}),{enabled:!!t}),j=Z({isSuccess:d,data:C!=null?C:{pages:[],pageParams:[]},key:"structures",returnList:n=>({label:`${n.structureCode} - ${n.name}`,value:JSON.stringify(n)})}),i=n=>{p(n?["all"]:[])},P=n=>{c(n)},M=()=>{let n=[];s.includes("all")?n=["all"]:s.map(f=>{n.push(JSON.parse(f).uuid)}),m.length<1?b({status:"warning",description:"Wajib pilih template",position:"top",title:"Validasi",isClosable:!0}):l.mutate({project_id:+t,question_template_id:m.map(f=>f.value),structure_ids:n},{onSuccess:f=>{b({status:"success",description:f.message,position:"top",title:"Success",isClosable:!0}),g.invalidateQueries(["project_structures"]),g.invalidateQueries(["statisic_project"]),S(T())},onError:f=>N(f,b)})};return r(_,{p:5,children:[r(u,{flexDirection:"column",gap:5,children:[e(Qt,{placeholder:"-- Pilih Template --",isMulti:!0,value:m,onChange:P}),e(ne,{onChange:n=>{n.preventDefault(),o(n.target.value)}}),e(Pe,{value:"all",onChange:n=>i(n.target.checked),children:"Semua"}),s&&s.length>0&&!s.includes("all")&&e(_,{children:r(u,{gap:3,alignItems:"center",children:[r(k,{fontSize:"sm",children:["Terpilih ",s.length," Unit "]}),e(U,{variant:"link",colorScheme:"red",size:"sm",onClick:()=>p([]),children:"Hapus Pilihan"})]})}),r(_,{maxH:500,overflowY:"auto",children:[y&&e(Y,{w:"100%",h:20}),x&&e(k,{children:"Error"}),d&&!s.includes("all")&&e(Qe,{options:j,direction:"column",value:s,disabled:s.includes("all"),onChange:p})]}),A&&e(u,{justifyContent:"center",w:"100%",children:e(U,{size:"sm",onClick:()=>L(),children:"Load More"})})]}),e(X,{children:e(U,{variant:"solid",onClick:M,isLoading:l.isLoading,children:"Simpan"})})]})},Le=({...t})=>r(De,{...t,children:[e("path",{d:"M2 14L5.23309 16.4248C5.66178 16.7463 6.26772 16.6728 6.60705 16.2581L15 6",stroke:"currentColor",strokeWidth:"2",fill:"transparent",strokeLinecap:"round"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.87451 15.7801L11.6031 17.163C12.4589 17.8477 13.7064 17.716 14.4004 16.8677L22.7741 6.63324C23.1238 6.20579 23.0608 5.57577 22.6333 5.22604C22.2059 4.87631 21.5759 4.93932 21.2262 5.36676L12.8525 15.6013L11.1411 14.2321L9.87451 15.7801Z",fill:"currentColor"})]}),Rt=({projectId:t})=>{const{control:a,formState:o}=Me();return r(D.exports.Fragment,{children:[e($,{control:a,formState:o,label:"Kode Unit kerja",id:"structure_code",name:"structure_code",rules:{required:{value:!1,message:"Dibutuhkan"}},children:e(Ie,{})}),e($,{control:a,formState:o,label:"Nama Unit Kerja",id:"structure_name",name:"structure_name",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(Ie,{})}),e($,{control:a,formState:o,label:"Parent",id:"structure_parent",name:"structure_parent",placeholder:"-- Parent Unit Kerja --",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(ge,{children:e(Te,{projectId:t,prepend:[{label:"Root",value:0}]})})})]})},Vt=({projectId:t,onSubmit:a,isLoading:o=!1})=>r(ie,{id:"form-unit-kerja-single",onSubmit:a,children:[e(u,{flexDirection:"column",gap:5,p:5,children:e(Rt,{projectId:t})}),e(X,{children:e(U,{type:"submit",size:"sm",leftIcon:e(_e,{}),isLoading:o,children:"Submit"})})]}),Bt=({projectId:t,active:a,onClick:o})=>{const[s,p]=D.exports.useState(null),{colorMode:m}=Ve(),c=R(),b=q(ht),S=q(gt),h=H(),l=B(),g=O(s,100),C=()=>{c(Q(e(Vt,{isLoading:b.isLoading,projectId:t,onSubmit:y}),"Tambah Satu Unit Kerja","lg"))},y=n=>{b.mutate({kode:n.structure_code,nama:n.structure_name,project_id:+t,parent:n.structure_parent.value.toString(),uuid:Dt()},{onSuccess:f=>{l({status:"success",description:f.message,position:"top",title:"Success",isClosable:!0}),h.invalidateQueries(["project_structures"]),c(T())},onError:f=>N(f,l)})},{data:d,isLoading:x,isSuccess:A,isError:L}=W(["project_structures",t,g],()=>Se({pageSize:50,current:1,search:g,project:+t}),{enabled:!!t}),j=n=>{S.mutate({id:n,projectId:t},{onSuccess:f=>{l({status:"success",description:f.message,position:"top",title:"Success",isClosable:!0}),h.invalidateQueries(["project_structures"]),h.invalidateQueries(["statisic_project"]),o(null),c(T())},onError:f=>N(f,l)})},i=n=>{c(Q(r(z,{children:[e(Pt,{children:"data data pendukung akan dihapus. Aksi ini tidak bisa di kembalikan"}),e(Ce,{isLoading:S.isLoading,onDelete:()=>j(n)})]}),"Apakah kamu yakin ingin menghapus unit kerja ini?"))},P=D.exports.useCallback((n,f=0)=>{var v,E,ke;return(n==null?void 0:n.children)&&((v=n==null?void 0:n.children)==null?void 0:v.length)>0?r(_,{position:"relative",children:[e(w,{label:n.name,children:r(u,{py:1,px:2,my:2,cursor:"pointer",justifyContent:"space-between",borderRadius:15,alignItems:"center",_hover:{backgroundColor:"rgba(104,211,145,0.35)"},backgroundColor:a===n.uuid?"rgba(104,211,145,0.35)":"none",onClick:()=>{o(n.uuid)},children:[r(k,{noOfLines:[1],children:[n.structureCode," - ",n.name]}),r(u,{gap:2,children:[e(Le,{color:n.total_questions>0&&"brand.light"}),e(w,{label:"Delete unit kerja",children:e(F,{"aria-label":"delete",onClick:()=>i(n.uuid),icon:e(re,{}),variant:"link",color:"red.500",p:0})})]})]})}),e(_,{sx:{ml:5},children:(E=n==null?void 0:n.children)==null?void 0:E.map(qe=>P(qe,f+1))}),e(_,{width:.5,height:`calc(100% - ${((ke=n==null?void 0:n.children)==null?void 0:ke.length)+38}px)`,bg:m==="light"?"black":"white",position:"absolute",left:3,top:9})]}):e(w,{label:n.name,children:r(u,{py:1,my:2,px:2,_hover:{backgroundColor:"rgba(104,211,145,0.35)"},backgroundColor:a===n.uuid?"rgba(104,211,145,0.35)":"none",cursor:"pointer",onClick:()=>o(n.uuid),gap:5,justifyContent:"space-between",alignItems:"center",borderRadius:15,children:[r(k,{noOfLines:[1],children:[n.structureCode," - ",n.name]}),r(u,{gap:2,children:[e(Le,{color:n.total_questions>0&&"brand.light"}),e(w,{label:"Delete unit kerja",children:e(F,{"aria-label":"delete",icon:e(re,{}),onClick:()=>i(n.uuid),color:"red.500",variant:"link",p:0})})]})]})})},[a,m]);return r(ae,{children:[r(oe,{children:[r(u,{justifyContent:"space-between",alignItems:"center",children:[e(k,{fontWeight:"medium",fontSize:19,children:"Unit Kerja"}),e(w,{label:"Atur Template",children:e(F,{"aria-label":"Add Questioner",onClick:()=>{c(Q(e(qt,{projectId:t}),"Atur Template Pertanyaan per Unit kerja","lg"))},icon:e(he,{}),variant:"outline",border:"none"})})]}),e("small",{children:"Centang dua hijau : sudah diatur pertanyaan"})]}),r(le,{children:[e(ne,{onChange:n=>{n.preventDefault(),p(n.target.value)}}),r(_,{mt:3,children:[L&&e(Fe,{}),x&&"Loading...",A&&!x&&(d==null?void 0:d.structures)&&(d==null?void 0:d.structures.length)>0?g===""||!g?xt("uuid","parent_id",d==null?void 0:d.structures).map(n=>P(n,0)):d==null?void 0:d.structures.map(n=>P(n,0)):e(G,{})]}),e(Be,{my:5}),e(U,{size:"sm",w:"100%",variant:"outline",onClick:C,leftIcon:e(he,{}),children:"Tambah Unit Kerja"})]})]})},Ht=({initialValues:t={project_description:null,project_name:null,project_status:null,project_code:null,project_type:null,project_due_date:null},isLoading:a=!1,onSubmit:o})=>{const s=R();return r(ie,{initialValues:t,onSubmit:o,id:"form-project-info",children:[e(_,{p:5,children:e(it,{disabled:{project_type:!0}})}),e(X,{children:r(u,{alignItems:"center",gap:5,children:[e(U,{variant:"outline",colorScheme:"red",size:"sm",onClick:()=>s(T()),children:"Cancel"}),e(U,{type:"submit",variant:"solid",isLoading:a,size:"sm",leftIcon:e(_e,{}),children:"Submit"})]})})]})},Ot=({projectId:t})=>{const[a,o]=D.exports.useState(),[s,p]=D.exports.useState([]),m=B(),c=H(),b=R(),S=O(a,200),h=q(ft),{data:l,isLoading:g,isSuccess:C,isError:y,hasNextPage:d,fetchNextPage:x}=K(["assign_users",S,t],({pageParam:i})=>bt({pageSize:20,current:i,search:S,project_id:t})),A=Z({isSuccess:C,data:l!=null?l:{pages:[],pageParams:[]},key:"users",filterFn:i=>i.roleId!==1,returnList:i=>{var P,M;return{label:r(u,{gap:2,alignItems:"center",children:[e(se,{size:"xs",objectFit:"cover",name:(P=i.full_name)!=null?P:"",src:i.profile_pict?`/api/v1/profiles/${i.profile_pict}`:"/default-image.jpg"}),e(k,{fontSize:"sm",children:(M=i.full_name)!=null?M:""})]}),value:JSON.stringify(i)}}}),L=i=>{p(i?["all"]:[])};return r(ie,{onSubmit:i=>{const P=i.job.map(f=>f.value),M=i.unit_kerja.map(f=>f.value);let n=[];s.includes("all")?n=["all"]:s.map(f=>{n.push(String(JSON.parse(f).id))}),h.mutate({project_id:+t,job:P,structure_id:M,users:n},{onSuccess:f=>{m({status:"success",title:"success",description:f.message,position:"top",isClosable:!0}),c.invalidateQueries(["project_detail"]),c.invalidateQueries(["users_assigned"]),b(T())},onError:f=>N(f,m)})},id:"form-assign",children:[e(_,{p:5,children:r(u,{flexDirection:"column",gap:5,children:[e(we,{project_id:t}),e(ne,{onChange:i=>{i.preventDefault(),o(i.target.value)}}),e(Pe,{value:"all",onChange:i=>L(i.target.checked),children:"Semua"}),s&&s.length>0&&!s.includes("all")&&e(z,{children:e(_,{children:r(u,{gap:3,alignItems:"center",children:[r(k,{fontSize:"sm",children:["Terpilih ",s.length," User "]}),e(U,{variant:"link",colorScheme:"red",size:"sm",onClick:()=>p([]),children:"Hapus Pilihan"})]})})}),r(_,{maxH:500,overflowY:"auto",children:[g&&e(Y,{w:"100%",h:20}),y&&e(k,{children:"Error"}),C&&!s.includes("all")&&e(Qe,{options:A,direction:"column",value:s,disabled:s.includes("all"),onChange:p})]}),d&&e(u,{justifyContent:"center",w:"100%",children:e(U,{size:"sm",onClick:()=>x(),isLoading:g,children:"Load More"})})]})}),e(X,{children:e(U,{type:"submit",isLoading:h.isLoading,children:"Simpan"})})]})},Kt=({projectId:t})=>{var S;const{fetchNextPage:a,hasNextPage:o,isError:s,isSuccess:p,isLoading:m,data:c,isFetchingNextPage:b}=K(["log_project",t],({pageParam:h=1})=>St({current:h,search:"",projectId:t,pageSize:15}),{getNextPageParam:h=>je(h),getPreviousPageParam:h=>ve(h)});return r(ae,{children:[e(oe,{children:"Log Activity"}),r(le,{maxH:500,minH:{base:"auto",xl:500},overflowY:"auto",children:[m&&e(fe,{size:"xs",isIndeterminate:!0}),p&&c.pages[0].logs&&((S=c.pages[0].logs)==null?void 0:S.length)>0?r(z,{children:[c.pages.map(h=>h.logs&&h.logs.length>0?e(z,{children:h.logs.map((l,g)=>e(_,{mb:3,children:e(At,{comment:l.description,time:te(l.time).fromNow(),user:l.user.name},g)}))}):e(G,{})),o&&e(u,{my:5,justifyContent:"center",children:e(U,{size:"sm",onClick:()=>a(),isLoading:m,children:"Load More"})})]}):null]}),e(yt,{children:e(U,{variant:"link",rightIcon:e(Et,{}),disabled:!0,as:He,children:"Lihat Semua"})})]})},$t=D.exports.lazy(()=>Oe(()=>import("./Questionaire.e3569bf6.js"),["assets/Questionaire.e3569bf6.js","assets/index.0e24cb86.js","assets/index.0fec9be9.css","assets/PagePadding.f9f1bdac.js","assets/index.esm.726820fc.js","assets/Detailinformation.255e4d07.js","assets/CommentsIcon.7c801b68.js","assets/FileIcon.5750f3bf.js","assets/dayjs.min.de763c4f.js","assets/relativeTime.1fcc03b9.js","assets/index.esm.ba2a2cc9.js","assets/index.esm.008f63b2.js","assets/index.esm.25501534.js","assets/FormFieldControl.6d022860.js","assets/index.238261e4.js","assets/FieldTextArea.eda53a25.js","assets/index.esm.6acc2bf5.js","assets/FieldText.629ceab0.js","assets/FieldCustom.a890d568.js","assets/useSelectDataMapper.c05d958f.js","assets/useDebounce.f82902b3.js","assets/usersActions.997728a2.js","assets/select.f59423ba.js","assets/slicedToArray.49cdadd5.js","assets/objectWithoutPropertiesLoose.2d2ba74a.js","assets/index.esm.9fed1f3b.js","assets/SelectLookup.9c949968.js","assets/FilterIcon.eea7884e.js","assets/projectActions.133a6b49.js","assets/ErrorFetching.2cd1a256.js","assets/useTranslation.d6d641af.js","assets/useError.ed61bdd7.js","assets/ArrowLeftIcon.12227cb3.js","assets/questionActions.28a337fa.js","assets/ErrorEmpty.82811164.js","assets/EditIcon.0dd57a11.js","assets/uiActions.408d82e2.js","assets/Page.b0ec3cd0.js","assets/index.esm.3048a115.js","assets/inheritsLoose.5105dba6.js","assets/index.esm.e1b3c63e.js"])),$r=()=>{const{id:t}=Ke(),a=B(),o=R(),s=Ae(),p=H(),[m,c]=D.exports.useState(null),b=D.exports.useRef(null),S=q(jt),h=q(vt),{data:l,isLoading:g,isSuccess:C,isError:y,refetch:d}=W(["project_detail",t],()=>Ct(+t),{enabled:!!t}),{data:x,isSuccess:A}=W(["users_assigned",t],()=>Ut(t),{enabled:!!t}),L=v=>{h.mutate(v,{onSuccess:E=>{a({status:"success",title:"Success",isClosable:!0,description:E.message,position:"top"}),o(T()),s("/activity/projects")},onError:E=>N(E,a)})},j=v=>{o(Q(e(Ce,{onDelete:()=>L(v)}),"Apakah kamu yakin ingin menghapus project ini ?","sm"))},i=v=>{S.mutate({id:t,payload:{project_code:v.project_code,project_description:v.project_description,project_due_date:v.project_due_date,project_name:v.project_name,project_status:v.project_status.value,project_type:v.project_type.value}},{onSuccess:E=>{a({status:"success",title:"Success",description:E.message,position:"top",isClosable:!0}),p.invalidateQueries(["log_project"]),o(T()),d()},onError:E=>N(E,a)})},P=()=>{o(Q(e(Ht,{onSubmit:i,isLoading:S.isLoading,initialValues:{project_description:l.data.description,project_name:l.data.name,project_status:{label:l.data.select_status_label,value:l.data.status},project_code:l.data.project_code,project_type:{label:l.data.select_project_type_label,value:l.data.type},project_due_date:new Date(l.data.project_date)}}),"Edit Project","lg"))},M=v=>{var E;c(v),(E=b.current)==null||E.removeFilterQuestions()},n=()=>{o(Q(e(Ot,{projectId:t}),"Atur User per Unit Kerja","md"))},f=()=>{o(Ee({component:e(Ne,{project_id:t}),title:"List Assigned User",size:"md"}))};return r($e,{title:"Detail Projek ",children:[g&&e(ye,{}),C&&r(z,{children:[e(Ye,{label:l.data.name,size:{base:"xs",sm:"md",md:"lg"},useBackButton:!0,additional:r(u,{alignItems:"center",gap:2,children:[e(xe,{variant:"subtle",colorScheme:"blue",children:l.data.type}),e(xe,{variant:"subtle",colorScheme:"green",children:l.data.status})]})}),r(tt,{x:6,children:[r(J,{templateColumns:{base:"repeat(1,1fr)",md:"repeat(2,1fr)"},gap:5,mb:5,children:[e(I,{children:e(wt,{data:l.data,onEdit:P,onDelete:()=>j(+t)})}),e(I,{children:e(Nt,{projectId:t})})]}),r(J,{templateColumns:"repeat(6,1fr)",gap:5,children:[e(I,{colSpan:{base:6,lg:6,xl:2},children:r(u,{gap:5,flexDirection:"column",children:[e(Bt,{projectId:t,onClick:v=>M(v),active:m}),e(Kt,{projectId:t})]})}),r(I,{colSpan:{base:6,lg:6,xl:4},children:[r(u,{alignItems:"center",gap:2,children:[e(k,{fontWeight:"semibold",children:"Assigned User"}),e(F,{"aria-label":"Add Assigned User",fontSize:26,onClick:n,variant:"outline",borderRadius:50,icon:e(he,{})}),A&&e(z,{children:x.data&&x.data.length>0&&r(z,{children:[e(kt,{size:"md",max:2,children:x.data.map(v=>e(se,{name:v.full_name,src:v.profile_pict?`/api/v1/profiles/${v.profile_pict}`:"/default-image.jpg"}))}),e(w,{label:"Edit Assigned Users",children:e(F,{"aria-label":"Edit Assigned User",fontSize:26,color:"yellow.500",variant:"link",onClick:f,icon:e(be,{})})})]})})]}),r(Mt,{children:[r(zt,{overflowX:"auto",overflowY:"hidden",children:[e(ue,{children:"Questioner"}),e(ue,{children:"Inventory"}),e(ue,{children:"Volume"})]}),r(Ft,{children:[e(pe,{p:0,children:m?e(D.exports.Suspense,{fallback:e(ye,{}),children:e($t,{ref:b,structuresId:m,projectId:+t,editable:!0})}):e(u,{justifyContent:"center",alignItems:"center",minH:500,children:e(G,{})})}),e(pe,{children:e(u,{justifyContent:"center",alignItems:"center",minH:500,children:e(G,{})})}),e(pe,{children:e(u,{justifyContent:"center",alignItems:"center",minH:500,children:e(G,{})})})]})]})]})]})]})]}),y&&e(Fe,{})]})};export{$r as default};
