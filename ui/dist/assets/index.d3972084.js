import{R as N,r as x,a as e,j as b,i as E,an as Q,T as q,ar as G,as as C,b as J,c as Y,e as H,g as W,D as $}from"./index.0e24cb86.js";import{P as X}from"./Page.b0ec3cd0.js";import{P as Z}from"./PageHeader.55df2133.js";import{P as O}from"./PagePadding.f9f1bdac.js";import{B as ee}from"./BeTable.bd0a6b42.js";import{U as ae}from"./useTableHelper.5363dd1c.js";import{u as te,F as R,a as re}from"./FormFieldControl.6d022860.js";import{F as k}from"./FieldCustom.a890d568.js";import{S as L}from"./SelectLookup.9c949968.js";import{S as se}from"./SelectCompanies.20c05ae5.js";import{u as w,G as U,b as z,a as B}from"./useSelectDataMapper.c05d958f.js";import{u as V}from"./useDebounce.f82902b3.js";import{w as ne,a as oe}from"./projectActions.133a6b49.js";import{S as A}from"./select.f59423ba.js";import{F as ie}from"./FilterIcon.eea7884e.js";import{d as le}from"./dayjs.min.de763c4f.js";import{D as K}from"./DownloadIcon.5b101119.js";import{g as ce,d as ue}from"./reportActions.75a5ebd0.js";import{u as pe,E as de}from"./useError.ed61bdd7.js";import{B as I}from"./index.esm.726820fc.js";import"./ArrowLeftIcon.12227cb3.js";import"./index.esm.008f63b2.js";import"./index.esm.25501534.js";import"./index.esm.9fed1f3b.js";import"./slicedToArray.49cdadd5.js";import"./index.esm.68da116c.js";import"./index.238261e4.js";import"./ErrorEmpty.82811164.js";import"./Pagination.656d36c1.js";import"./ExpandLeftIcon.708a001b.js";import"./ExpandRightIcon.0088b7a2.js";import"./useTranslation.d6d641af.js";import"./SearchInput.6e0cefa2.js";import"./companyActions.3310e078.js";import"./objectWithoutPropertiesLoose.2d2ba74a.js";const me=N.forwardRef(({name:o,onChange:n,onBlur:r,value:s,placeholder:p,watch:d,companyKey:u},m)=>{const[g,h]=x.exports.useState(""),P=V(g,1e3),l=d(u),{fetchNextPage:t,hasNextPage:F,isError:M,isSuccess:T,isLoading:y,isFetching:j,data:f,isFetchingNextPage:S}=w(["fetch_select_project_by_company",P,l==null?void 0:l.value],({pageParam:a=1})=>ne({current:a,search:P,value:s==null?void 0:s.value,company:l==null?void 0:l.value,pageSize:15}),{enabled:!!(l!=null&&l.value),cacheTime:0,refetchOnMount:!1,refetchOnWindowFocus:!1,getNextPageParam:a=>U(a),getPreviousPageParam:a=>z(a)}),_=B({isSuccess:T,data:f!=null?f:{pages:[],pageParams:[]},key:"projects",returnList:a=>({label:a.name,value:a.id})});return e(A,{name:o,ref:m,onChange:n,onBlur:r,value:s,onInputChange:h,isLoading:Boolean(y&&j),isClearable:!0,noOptionsMessage:({inputValue:a})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:a})=>b(E,{children:[b("div",{children:['Mencari "',a,'"']}),y&&e(Q,{size:"xs",width:"100%",isIndeterminate:!0}),M&&e("div",{children:"Error saat mencari data"})]}),options:_,placeholder:e(q,{noOfLines:[1],children:p}),closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{F&&t()},closeMenuOnSelect:!0})}),ge=N.forwardRef(({name:o,onChange:n,onBlur:r,value:s,placeholder:p,watch:d,projectKey:u,useAll:m=!1},g)=>{const[h,P]=x.exports.useState(""),l=V(h,1e3),t=d(u),{fetchNextPage:F,hasNextPage:M,isError:T,isSuccess:y,isLoading:j,isFetching:f,data:S}=w(["fetch_select_structure_by_project",l,t==null?void 0:t.value],({pageParam:a=1})=>oe({current:a,search:l,value:s==null?void 0:s.value,project:t==null?void 0:t.value,pageSize:15}),{enabled:!!(t!=null&&t.value),refetchOnMount:!1,refetchOnWindowFocus:!1,getNextPageParam:a=>U(a),getPreviousPageParam:a=>z(a)}),_=B({isSuccess:y,data:S!=null?S:{pages:[],pageParams:[]},key:"structures",prepend:m?[{label:"Semua",value:"all"}]:[],returnList:a=>({label:a.name,value:a.uuid})});return e(A,{name:o,ref:g,onChange:n,onBlur:r,value:s,onInputChange:P,isLoading:j&&f,isClearable:!0,noOptionsMessage:({inputValue:a})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:a})=>b(E,{children:[b("div",{children:['Mencari "',a,'"']}),j&&e(Q,{size:"xs",width:"100%",isIndeterminate:!0}),T&&e("div",{children:"Error saat mencari data"})]}),options:_,placeholder:e(q,{noOfLines:[1],children:p}),closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{M&&F()},closeMenuOnSelect:!0})}),he=()=>{const{control:o,formState:n,watch:r,setValue:s}=te();return b(G,{templateColumns:{base:"repeat(1,1fr)",md:"repeat(2,1fr)",lg:"repeat(4,1fr)"},gap:5,children:[e(C,{children:e(R,{placeholder:"-- Company --",control:o,name:"company",formState:n,label:"Company",id:"company",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(k,{children:e(se,{})})})}),e(C,{children:e(R,{placeholder:"-- Project --",control:o,name:"project",formState:n,label:"Project",id:"project",watch:r,rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(k,{children:e(me,{companyKey:"company"})})})}),e(C,{children:e(R,{placeholder:"-- Unit Kerja --",control:o,name:"structures",formState:n,label:"Unit Kerja",id:"structures",watch:r,rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(k,{children:e(ge,{projectKey:"project",useAll:!0})})})}),e(C,{children:e(R,{placeholder:"-- Pilih Status Pertanyaan --",control:o,name:"project_status",formState:n,label:"Status Pertanyaan",id:"project_status",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(k,{children:e(L,{type_:"QUESTION_STATUS",useAll:!0})})})}),e(C,{children:e(R,{placeholder:"-- Project Type --",control:o,name:"project_type",formState:n,label:"Project Type",id:"project_type",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(k,{children:e(L,{type_:"PROJECT_TYPE",useAll:!0})})})})]})},fe=o=>{const n=J();return{initialValues:x.exports.useMemo(()=>{let s=o;const p=n.search.split("?");if(p.length>0){const d=new URLSearchParams(p[1]);for(const[u,m]of d.entries())if(m!=="undefined"&&m!=="null"){const g=decodeURIComponent(m);try{s[u]=JSON.parse(g)}catch{s[u]=g}}else s[u]=null;return s}else return s},[n.search])}},ye=o=>Object.keys(o).map(n=>n+"="+encodeURIComponent(o[n])).join("&"),Se="/report/questionaire",ea=()=>{var f,S,_;const[o,n]=x.exports.useState({}),[r,s]=x.exports.useState({company:null,project:null,structures:null,project_type:null,project_status:null}),p=Y(),d=pe(ue),u=H(),{setPagination:m,searchValue:g,pagination:h,handleSearch:P}=ae(),{initialValues:l}=fe(r);x.exports.useEffect(()=>{s(l)},[]);const{data:t,isLoading:F,isFetching:M}=W({queryKey:["report",{searchValue:g,...h,...r}],queryFn:()=>{var a,i,c,v,D;return ce({pageSize:h.pageSize,current:h.pageIndex+1,search:g,project_id:(a=r.project)==null?void 0:a.value,project_type:(i=r.project_type)==null?void 0:i.value,project_status:(c=r.project_status)==null?void 0:c.value,company_id:(v=r.company)==null?void 0:v.value,structure_id:(D=r.structures)==null?void 0:D.value})},enabled:!!r.company,keepPreviousData:!1,cacheTime:0,staleTime:0}),T=a=>{let i={};for(const[v,D]of Object.entries(a))i[v]=JSON.stringify(D);const c=ye(i);p(`${Se}?${c}`)},y=()=>{var a,i;d.mutate({project_id:(a=r.project)==null?void 0:a.value,company_id:(i=r.company)==null?void 0:i.value},{onSuccess:c=>{u({status:"info",title:"Info",description:c.message,position:"top",isClosable:!0}),p("/download-status")},onError:c=>de(c,u)})},j=N.useMemo(()=>[{id:"No",header:"No",accessorFn:(a,i)=>i+1},{id:"Unit Kerja",header:"Unit Kerja",accessorKey:"unit_kerja"},{id:"Pertanyaan",header:"Pertanyaan",accessorKey:"name"},{id:"Status",header:"Status",accessorKey:"status"},{id:"Jawaban",header:"Jawaban",accessorKey:"answer",cell:({row:a})=>{var i,c;return((i=a.original)==null?void 0:i.raw_status)==="NOT_ANSWERED"?"":(c=a.original)==null?void 0:c.answer.split(`
`).map(v=>e("p",{children:v}))}},{id:"Tanggal Terjawab",header:"Tanggal Terjawab",accessorKey:"answered_at",cell:({row:a})=>{var i,c;return(i=a.original)!=null&&i.answered_at?le((c=a.original)==null?void 0:c.answered_at).format("DD MMMM YYYY HH:mm"):null}}],[]);return b(X,{title:"Report Questionaire",children:[e(Z,{label:"Report Questionaire"}),e($,{}),e(O,{x:6,y:6,children:b(re,{onSubmit:T,id:"form-filter-report-questioner",initialValues:{...r},children:[e(he,{}),e(I,{mt:5,leftIcon:e(ie,{}),type:"submit",children:"Filter"})]})}),e(O,{x:0,y:6,children:e(ee,{enableResizeColumn:!1,useSearchInput:!0,loading:F&&M,onSearch:P,onChangeTable:m,onCheckboxChange:n,leftFilter:e(I,{size:"sm",display:{base:"none",md:"block"},leftIcon:e(K,{}),isLoading:d.isLoading,onClick:y,alignSelf:"center",children:"Download"}),bottomFilter:e(I,{size:"sm",display:{base:"block",md:"none"},isLoading:d.isLoading,leftIcon:e(K,{}),onClick:y,alignSelf:"center",children:"Download"}),pagination:{pageIndex:Number((f=t==null?void 0:t.page)!=null?f:0)-1,pageSize:Number((S=t==null?void 0:t.page_size)!=null?S:10)},pageCount:Number((_=t==null?void 0:t.page_count)!=null?_:0),rowSelectionProps:o,totalRecords:t==null?void 0:t.total,data:(t==null?void 0:t.questioner)||[],columns:j})})]})};export{ea as default};
