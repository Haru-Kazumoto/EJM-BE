import{j as t,I as be,a as e,R as Se,r as L,h as z,an as Ce,T as v,d as F,a4 as H,ae as Z,f as J,B as _,F as m,c as je,aq as K,ar as A,aP as re,aQ as ne,aR as Ue,u as Te,aS as Fe,aT as we,g as pe,aj as me}from"./index.4df5dae3.js";import{P as Ne}from"./Page.ce903aa1.js";import{P as Qe}from"./PageHeader.954bf5c1.js";import{F as Re,a as Ve,I as Be,c as Oe,f as He,g as qe,P as $e}from"./PagePadding.8c1b0086.js";import{A as ve}from"./AddIcon.159dfaf4.js";import{E as se}from"./EditIcon.3ffc7b25.js";import{D as w}from"./Detailinformation.1cb8321f.js";import{B as Ge}from"./BuildingIcon.47ae7328.js";import{C as We,F as Ye}from"./FormFieldProject.7aa03029.js";import{U as Je}from"./UserIcon.342b47fc.js";import{d as ie}from"./dayjs.min.5d3dab01.js";import{r as Ke}from"./relativeTime.178d0d32.js";import{D as _e}from"./DeleteIcon.8cd44a6f.js";import{E as Ze}from"./EyeIcon.a6a75016.js";import{c as T,o as R,a as Pe}from"./uiActions.0615ad97.js";import{S as X}from"./SearchInput.7f0274ff.js";import{a as oe,S as Xe,u as et,b as tt,d as rt,c as nt,e as it,s as st,f as ot,h as at,i as lt,j as ct}from"./projectActions.f553fa80.js";import{u as B}from"./useDebounce.b8118708.js";import{u as q,a as $}from"./useSelectDataMapper.6391f061.js";import{C as ye}from"./ConfirmDelete.bb641ee2.js";import{u as dt,F as he,a as ae}from"./FormFieldControl.b614070a.js";import{G as ke,a as xe}from"./useGetPrevPageParam.cb1386c2.js";import{S as Ie}from"./select.0fe29549.js";import{F as ge}from"./FieldCustom.5b6685a5.js";import{S as Ae}from"./SaveIcon.2cbae624.js";import{u as V,E as Q}from"./useError.46aba7e3.js";import{f as ee}from"./index.esm.b22a74c4.js";import{B as E,I as U}from"./index.esm.780dcd2c.js";import{A as te,a as ut}from"./index.esm.4a036cc6.js";import{C as le,c as ce,a as de}from"./index.esm.a501b0bf.js";import{T as N}from"./index.esm.2ca9b441.js";import{b as pt}from"./aoaToTree.b87a9c87.js";import{E as Le}from"./ErrorFetching.5d5f8a6b.js";import{E as O}from"./ErrorEmpty.d1acacce.js";import{a as mt,C as ue}from"./index.esm.17aaa28e.js";import{g as ht}from"./questionActions.1a7d06af.js";import{S as De}from"./index.esm.f60c0a2c.js";import{e as gt}from"./usersActions.d0e9b122.js";import{T as ft,a as bt,b as G,c as St,d as W}from"./index.esm.ad9d805c.js";import"./ArrowLeftIcon.0c9057ff.js";import"./FieldText.6d44809e.js";import"./slicedToArray.556cd5c1.js";import"./FieldTextArea.823a0dbf.js";import"./useTranslation.d56b7bba.js";import"./objectWithoutPropertiesLoose.2d2ba74a.js";import"./index.esm.f3b9d19a.js";import"./inheritsLoose.cba8c0e3.js";import"./index.238261e4.js";const Y=({...r})=>t(be,{...r,children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 5C3 4.44772 3.44772 4 4 4H16C16.5523 4 17 4.44772 17 5C17 5.55228 16.5523 6 16 6H4C3.44772 6 3 5.55228 3 5Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 10C3 9.44772 3.44772 9 4 9H16C16.5523 9 17 9.44772 17 10C17 10.5523 16.5523 11 16 11H4C3.44772 11 3 10.5523 3 10Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 15C9 14.4477 9.44772 14 10 14H16C16.5523 14 17 14.4477 17 15C17 15.5523 16.5523 16 16 16H10C9.44772 16 9 15.5523 9 15Z",fill:"currentColor"})]}),Ct=Se.forwardRef(({name:r,onChange:c,onBlur:a,value:i,placeholder:p,projectId:h,isMulti:S=!1},g)=>{const[d,u]=L.exports.useState(""),j=B(d,1e3),{fetchNextPage:b,hasNextPage:C,isError:P,isSuccess:n,isLoading:y,data:k}=q(["fetch_select_structure_by_project_primitive",j,h],({pageParam:l=1})=>oe({current:l,search:j,value:i==null?void 0:i.value,project:+h,pageSize:15}),{enabled:!!h,refetchOnMount:!1,refetchOnWindowFocus:!1,getNextPageParam:l=>ke(l),getPreviousPageParam:l=>xe(l)}),I=$({isSuccess:n,data:k!=null?k:{pages:[],pageParams:[]},key:"structures",returnList:l=>({label:l.name,value:l.uuid})});return e(Ie,{name:r,ref:g,onChange:c,onBlur:a,value:i,isMulti:S,onInputChange:u,isLoading:y,isClearable:!0,noOptionsMessage:({inputValue:l})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:l})=>t(z,{children:[t("div",{children:['Mencari "',l,'"']}),y&&e(Ce,{size:"xs",width:"100%",isIndeterminate:!0}),P&&e("div",{children:"Error saat mencari data"})]}),options:I,placeholder:e(v,{noOfLines:[1],children:p}),closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{C&&b()},closeMenuOnSelect:!0})}),Ee=({project_id:r})=>{const{control:c,formState:a}=dt();return t(z,{children:[e(he,{control:c,name:"job",formState:a,id:"job",placeholder:"-- Pilih Pekerjaan --",rules:{required:{value:!0,message:"Dibutuhkan"},min:{value:1,message:"Dibutuhkan"}},children:e(ge,{children:e(Xe,{type_:"PROJECT_JOB",isMulti:!0})})}),e(he,{control:c,name:"unit_kerja",formState:a,id:"unit_kerja",placeholder:"-- Pilih Unit Kerja --",rules:{required:{value:!0,message:"Dibutuhkan"}},children:e(ge,{children:e(Ct,{projectId:r,isMulti:!0})})})]})},jt=({project_id:r,user_id:c})=>{const a=F(),i=H(),p=Z(),h=V(et),{data:S,isLoading:g,isError:d,isSuccess:u}=J(["detail_assigned_user",r,c],()=>tt({projectId:r,userId:c}),{enabled:!!r&&!!c,cacheTime:0,onError:b=>Q(b,i)});return t(z,{children:[d&&e(_,{p:5,children:"Error"}),g&&e(_,{p:5,children:"Loading..."}),u&&t(ae,{onSubmit:b=>{const C=b.job.map(n=>n.value),P=b.unit_kerja.map(n=>n.value);h.mutate({userId:c,payload:{project_id:+r,job:C,structure_id:P}},{onSuccess:n=>{i({status:"success",title:"success",description:n.message,position:"top",isClosable:!0}),p.invalidateQueries(["project_detail"]),p.invalidateQueries(["users_assigned"]),a(T())},onError:n=>Q(n,i)})},id:"form-edit-assign-user",initialValues:{job:S.data.job,unit_kerja:S.data.structures},children:[e(_,{p:5,children:e(m,{gap:5,flexDirection:"column",children:e(Ee,{project_id:r})})}),e(ee,{children:t(m,{gap:5,children:[e(E,{variant:"outline",colorScheme:"red",size:"sm",onClick:()=>a(T()),children:"Cancel"}),e(E,{type:"submit",variant:"solid",isLoading:h.isLoading,size:"sm",leftIcon:e(Ae,{}),children:"Submit"})]})})]})]})},Me=({project_id:r})=>{const[c,a]=L.exports.useState();je();const i=F(),p=H(),h=Z(),S=B(c,200),g=V(rt),{data:d,isLoading:u,isSuccess:j,isError:b,isFetchingNextPage:C,hasNextPage:P,fetchNextPage:n}=q(["assign_users_paginated",S,r],({pageParam:s})=>nt({pageSize:20,current:s,search:S,project_id:r})),y=s=>{g.mutate({id:s,projectId:+r},{onSuccess:x=>{p({status:"success",title:"Sukses",description:x.message,position:"top",isClosable:!0}),h.invalidateQueries(["project_detail"]),h.invalidateQueries(["users_assigned"]),i(T())},onError:x=>Q(x,p)})},k=s=>{i(R(e(ye,{onDelete:()=>y(s)}),"Anda yakin ingin menghapus data ini ?","md"))},I=s=>{i(R(e(jt,{project_id:r,user_id:s}),"Edit User","md"))},l=$({isSuccess:j,data:d!=null?d:{pages:[],pageParams:[]},key:"users",filterFn:s=>s.roleId!==1,returnList:s=>{var x,D;return t(m,{justifyContent:"space-between",alignItems:"center",children:[t(m,{gap:2,alignItems:"center",children:[e(te,{size:"xs",objectFit:"cover",name:(x=s.full_name)!=null?x:"",src:s.profile_pict?`/api/v1/profiles/${s.profile_pict}`:"/default-image.jpg"}),e(v,{fontSize:"sm",children:(D=s.full_name)!=null?D:""})]}),t(_,{children:[e(U,{"aria-label":"Edit Assigned User",fontSize:20,color:"yellow.500",variant:"link",onClick:()=>I(s.id),icon:e(se,{})}),e(U,{"aria-label":"Delete Assigned User",fontSize:20,color:"red.500",variant:"link",onClick:()=>k(s.id),icon:e(_e,{})})]})]})}});return e(_,{p:5,children:t(m,{flexDirection:"column",gap:5,children:[e(X,{onChange:s=>{s.preventDefault(),a(s.target.value)}}),b&&"Error Occured",u&&"Loading..",j&&t(m,{flexDirection:"column",gap:2,maxH:300,overflowY:"auto",children:[l,P&&e(E,{size:"sm",mt:2,onClick:()=>n(),isLoading:C,children:"Load More"})]})]})})};ie.extend(Ke);const vt=({data:r,onDelete:c,onEdit:a})=>{const i=F(),p=()=>{i(Pe({component:e(Me,{project_id:r.id}),title:"List Assigned User",size:"md"}))};return t(le,{children:[e(ce,{children:t(m,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",children:[e(v,{fontWeight:"medium",fontSize:19,children:"Project Info"}),t(m,{alignItems:"center",gap:2,children:[e(N,{label:"Edit Project Info",children:e(U,{"aria-label":"Edit",variant:"unstyled",onClick:a,icon:e(se,{fontSize:28,color:"yellow.400"})})}),e(N,{label:"Delete Project",children:e(U,{"aria-label":"Delete",variant:"unstyled",onClick:c,icon:e(_e,{fontSize:28,color:"red.400"})})})]})]})}),e(de,{children:t(K,{templateColumns:{base:"repeat(1,1fr)",md:"repeat(2,1fr)",xl:"repeat(3,1fr)"},gap:{base:5,md:2},children:[e(A,{children:e(w,{leftIcon:e(Ge,{fontSize:21}),label:"Company",value:t(m,{gap:2,alignItems:"center",children:[e(te,{size:"xs",objectFit:"cover",name:r.company.name,src:r.company.profile_pict?`/api/v1/profiles/${r.company.profile_pict}`:"/default-image.jpg"}),e(v,{fontSize:12,children:r.company.name})]}),direction:"column"})}),e(A,{children:e(w,{leftIcon:e(Y,{fontSize:21}),label:"Project Type",direction:"column",value:r.select_project_type_label})}),e(A,{children:e(w,{leftIcon:e(Y,{fontSize:21}),label:"Project Status",direction:"column",value:r.select_status_label})}),e(A,{children:e(w,{leftIcon:e(Y,{fontSize:21}),label:"Project Code",direction:"column",value:r.project_code})}),e(A,{children:e(w,{leftIcon:e(We,{fontSize:21}),label:"Due Date",direction:"column",value:t("div",{children:[e(v,{children:ie(r.project_date).format("DD MMMM YYYY")}),t("small",{children:["(",ie(r.project_date).fromNow(),")"]})]})})}),e(A,{children:e(w,{leftIcon:e(Je,{fontSize:21}),label:"Assigned User",direction:"column",value:t(m,{gap:2,alignItems:"center",children:[e(v,{children:r.total_assigned_users.toString()}),e(N,{label:"Click to view Detail",children:e(U,{"aria-label":"Detail",variant:"link",onClick:p,icon:e(Ze,{})})})]})})}),e(A,{colSpan:{base:0,xl:3},children:e(w,{leftIcon:e(Y,{fontSize:21}),label:"Description",direction:"column",value:r.description})})]})})]})},_t=()=>t(le,{children:[e(ce,{children:e(v,{fontWeight:"medium",fontSize:19,children:"Task Progress"})}),e(de,{children:t(K,{templateColumns:{base:"repeat(1,1fr)",xl:"repeat(3,1fr)"},gap:5,children:[e(A,{children:t(m,{flexDirection:"column",alignItems:"center",children:[t("div",{style:{marginBottom:2},children:[e(v,{children:"Questionaire"}),e("small",{children:"( 10 / 210 )"})]}),e(_,{children:e(re,{value:40,color:"green.400",size:150,children:e(ne,{children:"40%"})})})]})}),e(A,{children:t(m,{flexDirection:"column",alignItems:"center",children:[t("div",{style:{marginBottom:2},children:[e(v,{children:"Inventory"}),e("small",{children:"( 10 / 50 )"})]}),e(_,{children:e(re,{value:20,color:"green.400",size:150,children:e(ne,{children:"20%"})})})]})}),e(A,{children:t(m,{flexDirection:"column",alignItems:"center",children:[t("div",{style:{marginBottom:2},children:[e(v,{children:"Volumes"}),e("small",{children:"( 5 / 10 )"})]}),e(_,{children:e(re,{value:10,color:"green.400",size:150,children:e(ne,{children:"10%"})})})]})})]})})]}),ze=({id:r,placeholder:c,label:a,isRequired:i=!1,errorMessage:p,type:h="text",leftElement:S,rightElement:g,isInvalid:d=!1,formState:u,direction:j="row",options:b,...C})=>t(Re,{isRequired:i,isInvalid:d,children:[a&&a!==""?e(Ve,{htmlFor:r,children:a}):null,t(Be,{children:[S&&e(Oe,{pointerEvents:"none",alignItems:"center",children:S}),e(mt,{...C,children:e(Ue,{direction:j,children:b&&b.length>0?b.map(P=>e(ue,{value:P.value,children:P.label})):null})}),g&&e(He,{alignItems:"center",children:g})]}),e(qe,{children:p})]}),Pt=Se.forwardRef(({name:r,onChange:c,onBlur:a,value:i,placeholder:p,isMulti:h=!1},S)=>{const[g,d]=L.exports.useState(""),u=B(g,1e3),{fetchNextPage:j,hasNextPage:b,isError:C,isSuccess:P,isLoading:n,data:y,isFetchingNextPage:k}=q(["fetch_select_question_templates",u],({pageParam:l=1})=>ht({current:l,search:u,value:i==null?void 0:i.value,using_active:!0,pageSize:15}),{getNextPageParam:l=>ke(l),getPreviousPageParam:l=>xe(l)}),I=$({isSuccess:P,data:y!=null?y:{pages:[],pageParams:[]},key:"question_templates",returnList:l=>({label:l.name,value:l.id})});return e(Ie,{name:r,ref:S,onChange:c,onBlur:a,isMulti:h,value:i,onInputChange:d,isLoading:k||n,isClearable:!0,noOptionsMessage:({inputValue:l})=>e("div",{children:"Tidak ada pilihan"}),loadingMessage:({inputValue:l})=>t(z,{children:[t("div",{children:['Mencari "',l,'"']}),n&&e(Ce,{size:"xs",width:"100%",isIndeterminate:!0}),C&&e("div",{children:"Error saat mencari data"})]}),options:I,placeholder:p,closeMenuOnScroll:!0,isSearchable:!0,onMenuScrollToBottom:()=>{b&&j()},closeMenuOnSelect:!0})}),yt=({projectId:r})=>{const[c,a]=L.exports.useState(),[i,p]=L.exports.useState([]),[h,S]=L.exports.useState(null),g=H(),d=F(),u=B(c,200),j=V(it),b=Z(),{data:C,isLoading:P,isSuccess:n,isError:y,hasNextPage:k,fetchNextPage:I}=q(["assign_project_structures",r,u],({pageParam:f})=>oe({pageSize:20,current:f,search:u,project:+r}),{enabled:!!r}),l=$({isSuccess:n,data:C!=null?C:{pages:[],pageParams:[]},key:"structures",returnList:f=>({label:`${f.structureCode} - ${f.name}`,value:JSON.stringify(f)})}),s=f=>{p(f?["all"]:[])},x=f=>{S(f)},D=()=>{let f=[];i.includes("all")?f=["all"]:i.map(o=>{f.push(JSON.parse(o).uuid)}),h.length<1?g({status:"warning",description:"Wajib pilih template",position:"top",title:"Validasi",isClosable:!0}):j.mutate({project_id:+r,question_template_id:h.map(o=>o.value),structure_ids:f},{onSuccess:o=>{g({status:"success",description:o.message,position:"top",title:"Success",isClosable:!0}),b.invalidateQueries(["project_structures"]),d(T())},onError:o=>Q(o,g)})};return t(_,{p:5,children:[t(m,{flexDirection:"column",gap:5,children:[e(Pt,{placeholder:"-- Pilih Template --",isMulti:!0,value:h,onChange:x}),e(X,{onChange:f=>{f.preventDefault(),a(f.target.value)}}),e(ue,{value:"all",onChange:f=>s(f.target.checked),children:"Semua"}),i&&i.length>0&&!i.includes("all")&&e(_,{children:t(m,{gap:3,alignItems:"center",children:[t(v,{fontSize:"sm",children:["Terpilih ",i.length," Unit "]}),e(E,{variant:"link",colorScheme:"red",size:"sm",onClick:()=>p([]),children:"Hapus Pilihan"})]})}),t(_,{maxH:500,overflowY:"auto",children:[P&&e(De,{w:"100%",h:20}),y&&e(v,{children:"Error"}),n&&!i.includes("all")&&e(ze,{options:l,direction:"column",value:i,disabled:i.includes("all"),onChange:p})]}),k&&e(m,{justifyContent:"center",w:"100%",children:e(E,{size:"sm",onClick:()=>I(),children:"Load More"})})]}),e(ee,{children:e(E,{variant:"solid",onClick:D,isLoading:j.isLoading,children:"Simpan"})})]})},fe=({...r})=>t(be,{...r,children:[e("path",{d:"M2 14L5.23309 16.4248C5.66178 16.7463 6.26772 16.6728 6.60705 16.2581L15 6",stroke:"currentColor",strokeWidth:"2",fill:"transparent",strokeLinecap:"round"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.87451 15.7801L11.6031 17.163C12.4589 17.8477 13.7064 17.716 14.4004 16.8677L22.7741 6.63324C23.1238 6.20579 23.0608 5.57577 22.6333 5.22604C22.2059 4.87631 21.5759 4.93932 21.2262 5.36676L12.8525 15.6013L11.1411 14.2321L9.87451 15.7801Z",fill:"currentColor"})]}),kt=({projectId:r,active:c,onClick:a})=>{const[i,p]=L.exports.useState(null),{colorMode:h}=Te(),S=F(),g=B(i,100),{data:d,isLoading:u,isSuccess:j,isError:b}=J(["project_structures",r,g],()=>oe({pageSize:100,current:1,search:g,project:+r}),{enabled:!!r}),C=L.exports.useCallback((n,y=0)=>{var k,I,l;return(n==null?void 0:n.children)&&((k=n==null?void 0:n.children)==null?void 0:k.length)>0?t(_,{position:"relative",children:[e(N,{label:n.name,children:t(m,{py:1,px:2,my:2,cursor:"pointer",justifyContent:"space-between",borderRadius:15,alignItems:"center",_hover:{backgroundColor:"rgba(104,211,145,0.35)"},backgroundColor:c===n.uuid?"rgba(104,211,145,0.35)":"none",onClick:()=>{a(n.uuid)},children:[t(v,{noOfLines:[1],children:[n.structureCode," - ",n.name]}),e(fe,{color:n.total_questions>0&&"brand.light"})]})}),e(_,{sx:{ml:5},children:(I=n==null?void 0:n.children)==null?void 0:I.map(s=>C(s,y+1))}),e(_,{width:.5,height:`calc(100% - ${((l=n==null?void 0:n.children)==null?void 0:l.length)+38}px)`,bg:h==="light"?"black":"white",position:"absolute",left:3,top:9})]}):e(N,{label:n.name,children:t(m,{py:1,my:2,px:2,_hover:{backgroundColor:"rgba(104,211,145,0.35)"},backgroundColor:c===n.uuid?"rgba(104,211,145,0.35)":"none",cursor:"pointer",onClick:()=>a(n.uuid),gap:5,alignItems:"center",borderRadius:15,children:[t(v,{noOfLines:[1],children:[n.structureCode," - ",n.name]}),e(fe,{color:n.total_questions>0&&"brand.light"})]})})},[c,h]);return t(le,{children:[t(ce,{children:[t(m,{justifyContent:"space-between",alignItems:"center",children:[e(v,{fontWeight:"medium",fontSize:19,children:"Unit Kerja"}),e(N,{label:"Atur Template",children:e(U,{"aria-label":"Add Questioner",onClick:()=>{S(R(e(yt,{projectId:r}),"Atur Template Pertanyaan per Unit kerja","lg"))},icon:e(ve,{}),variant:"outline",border:"none"})})]}),e("small",{children:"Centang dua hijau : sudah diatur pertanyaan"})]}),t(de,{children:[e(X,{onChange:n=>{n.preventDefault(),p(n.target.value)}}),t(_,{mt:3,children:[b&&e(Le,{}),u&&"Loading...",j&&(d==null?void 0:d.structures)&&(d==null?void 0:d.structures.length)>0?g===""||!g?pt("uuid","parent_id",d==null?void 0:d.structures).map(n=>C(n,0)):d==null?void 0:d.structures.map(n=>C(n,0)):e(O,{})]})]})]})},xt=({initialValues:r={project_description:null,project_name:null,project_status:null,project_code:null,project_type:null,project_due_date:null},isLoading:c=!1,onSubmit:a})=>{const i=F();return t(ae,{initialValues:r,onSubmit:a,id:"form-project-info",children:[e(_,{p:5,children:e(Ye,{disabled:{project_type:!0}})}),e(ee,{children:t(m,{alignItems:"center",gap:5,children:[e(E,{variant:"outline",colorScheme:"red",size:"sm",onClick:()=>i(T()),children:"Cancel"}),e(E,{type:"submit",variant:"solid",isLoading:c,size:"sm",leftIcon:e(Ae,{}),children:"Submit"})]})})]})},It=({projectId:r})=>{const[c,a]=L.exports.useState(),[i,p]=L.exports.useState([]),h=H(),S=Z(),g=F(),d=B(c,200),u=V(st),{data:j,isLoading:b,isSuccess:C,isError:P,hasNextPage:n,fetchNextPage:y}=q(["assign_users",d,r],({pageParam:s})=>ot({pageSize:20,current:s,search:d,project_id:r})),k=$({isSuccess:C,data:j!=null?j:{pages:[],pageParams:[]},key:"users",filterFn:s=>s.roleId!==1,returnList:s=>{var x,D;return{label:t(m,{gap:2,alignItems:"center",children:[e(te,{size:"xs",objectFit:"cover",name:(x=s.full_name)!=null?x:"",src:s.profile_pict?`/api/v1/profiles/${s.profile_pict}`:"/default-image.jpg"}),e(v,{fontSize:"sm",children:(D=s.full_name)!=null?D:""})]}),value:JSON.stringify(s)}}}),I=s=>{p(s?["all"]:[])};return t(ae,{onSubmit:s=>{const x=s.job.map(o=>o.value),D=s.unit_kerja.map(o=>o.value);let f=[];i.includes("all")?f=["all"]:i.map(o=>{f.push(String(JSON.parse(o).id))}),u.mutate({project_id:+r,job:x,structure_id:D,users:f},{onSuccess:o=>{h({status:"success",title:"success",description:o.message,position:"top",isClosable:!0}),S.invalidateQueries(["project_detail"]),S.invalidateQueries(["users_assigned"]),g(T())},onError:o=>Q(o,h)})},id:"form-assign",children:[e(_,{p:5,children:t(m,{flexDirection:"column",gap:5,children:[e(Ee,{project_id:r}),e(X,{onChange:s=>{s.preventDefault(),a(s.target.value)}}),e(ue,{value:"all",onChange:s=>I(s.target.checked),children:"Semua"}),i&&i.length>0&&!i.includes("all")&&e(z,{children:e(_,{children:t(m,{gap:3,alignItems:"center",children:[t(v,{fontSize:"sm",children:["Terpilih ",i.length," User "]}),e(E,{variant:"link",colorScheme:"red",size:"sm",onClick:()=>p([]),children:"Hapus Pilihan"})]})})}),t(_,{maxH:500,overflowY:"auto",children:[b&&e(De,{w:"100%",h:20}),P&&e(v,{children:"Error"}),C&&!i.includes("all")&&e(ze,{options:k,direction:"column",value:i,disabled:i.includes("all"),onChange:p})]}),n&&e(m,{justifyContent:"center",w:"100%",children:e(E,{size:"sm",onClick:()=>y(),isLoading:b,children:"Load More"})})]})}),e(ee,{children:e(E,{type:"submit",isLoading:u.isLoading,children:"Simpan"})})]})},At=L.exports.lazy(()=>Fe(()=>import("./Questionaire.fd44190e.js"),["assets/Questionaire.fd44190e.js","assets/index.4df5dae3.js","assets/index.65707869.css","assets/PagePadding.8c1b0086.js","assets/index.esm.780dcd2c.js","assets/Detailinformation.1cb8321f.js","assets/CommentsIcon.804457ce.js","assets/FileIcon.a3943f0b.js","assets/dayjs.min.5d3dab01.js","assets/relativeTime.178d0d32.js","assets/index.esm.4a036cc6.js","assets/index.esm.2ca9b441.js","assets/slicedToArray.556cd5c1.js","assets/EditIcon.3ffc7b25.js","assets/FormFieldControl.b614070a.js","assets/index.238261e4.js","assets/FieldTextArea.823a0dbf.js","assets/index.esm.a501b0bf.js","assets/FieldText.6d44809e.js","assets/FieldCustom.5b6685a5.js","assets/useGetPrevPageParam.cb1386c2.js","assets/useDebounce.b8118708.js","assets/useSelectDataMapper.6391f061.js","assets/usersActions.d0e9b122.js","assets/select.0fe29549.js","assets/objectWithoutPropertiesLoose.2d2ba74a.js","assets/index.esm.f3b9d19a.js","assets/projectActions.f553fa80.js","assets/FilterIcon.698af641.js","assets/ErrorFetching.5d5f8a6b.js","assets/useTranslation.d56b7bba.js","assets/useError.46aba7e3.js","assets/ArrowLeftIcon.0c9057ff.js","assets/questionActions.1a7d06af.js","assets/ErrorEmpty.d1acacce.js","assets/uiActions.0615ad97.js","assets/Page.ce903aa1.js","assets/index.esm.b22a74c4.js","assets/inheritsLoose.cba8c0e3.js","assets/index.esm.f60c0a2c.js"])),Pr=()=>{const{id:r}=we(),c=H(),a=F(),i=je(),[p,h]=L.exports.useState(null),S=L.exports.useRef(null),g=V(at),d=V(lt),{data:u,isLoading:j,isSuccess:b,isError:C,refetch:P}=J(["project_detail",r],()=>ct(+r),{enabled:!!r}),{data:n,isSuccess:y}=J(["users_assigned",r],()=>gt(r),{enabled:!!r}),k=o=>{d.mutate(o,{onSuccess:M=>{c({status:"success",title:"Success",isClosable:!0,description:M.message,position:"top"}),a(T()),i("/activity/projects")},onError:M=>Q(M,c)})},I=o=>{a(R(e(ye,{onDelete:()=>k(o)}),"Apakah kamu yakin ingin menghapus project ini ?","sm"))},l=o=>{g.mutate({id:r,payload:{project_code:o.project_code,project_description:o.project_description,project_due_date:o.project_due_date,project_name:o.project_name,project_status:o.project_status.value,project_type:o.project_type.value}},{onSuccess:M=>{c({status:"success",title:"Success",description:M.message,position:"top",isClosable:!0}),a(T()),P()},onError:M=>Q(M,c)})},s=()=>{a(R(e(xt,{onSubmit:l,isLoading:g.isLoading,initialValues:{project_description:u.data.description,project_name:u.data.name,project_status:{label:u.data.select_status_label,value:u.data.status},project_code:u.data.project_code,project_type:{label:u.data.select_project_type_label,value:u.data.type},project_due_date:new Date(u.data.project_date)}}),"Edit Project","lg"))},x=o=>{var M;h(o),(M=S.current)==null||M.removeFilterQuestions()},D=()=>{a(R(e(It,{projectId:r}),"Atur User per Unit Kerja","md"))},f=()=>{a(Pe({component:e(Me,{project_id:r}),title:"List Assigned User",size:"md"}))};return t(Ne,{title:"Detail Projek ",children:[j&&e(pe,{}),b&&t(z,{children:[e(Qe,{label:u.data.name,size:{base:"xs",sm:"md",md:"lg"},useBackButton:!0,additional:t(m,{alignItems:"center",gap:2,children:[e(me,{variant:"subtle",colorScheme:"blue",children:u.data.type}),e(me,{variant:"subtle",colorScheme:"green",children:u.data.status})]})}),t($e,{x:6,children:[t(K,{templateColumns:{base:"repeat(1,1fr)",md:"repeat(2,1fr)"},gap:5,mb:5,children:[e(A,{children:e(vt,{data:u.data,onEdit:s,onDelete:()=>I(+r)})}),e(A,{children:e(_t,{})})]}),t(K,{templateColumns:"repeat(6,1fr)",gap:5,children:[e(A,{colSpan:{base:6,lg:6,xl:2},children:e(kt,{projectId:r,onClick:o=>x(o),active:p})}),t(A,{colSpan:{base:6,lg:6,xl:4},children:[t(m,{alignItems:"center",gap:2,children:[e(v,{fontWeight:"semibold",children:"Assigned User"}),e(U,{"aria-label":"Add Assigned User",fontSize:26,onClick:D,variant:"outline",borderRadius:50,icon:e(ve,{})}),y&&e(z,{children:n.data&&n.data.length>0&&t(z,{children:[e(ut,{size:"md",max:2,children:n.data.map(o=>e(te,{name:o.full_name,src:o.profile_pict?`/api/v1/profiles/${o.profile_pict}`:"/default-image.jpg"}))}),e(N,{label:"Edit Assigned Users",children:e(U,{"aria-label":"Edit Assigned User",fontSize:26,color:"yellow.500",variant:"link",onClick:f,icon:e(se,{})})})]})})]}),t(ft,{children:[t(bt,{overflowX:"auto",overflowY:"hidden",children:[e(G,{children:"Questioner"}),e(G,{children:"Inventory"}),e(G,{children:"Volume"}),e(G,{children:"Log Activity"})]}),t(St,{children:[e(W,{p:0,children:p?e(L.exports.Suspense,{fallback:e(pe,{}),children:e(At,{ref:S,structuresId:p,projectId:+r,editable:!0})}):e(O,{})}),e(W,{children:e(O,{})}),e(W,{children:e(O,{})}),e(W,{children:e(O,{})})]})]})]})]})]})]}),C&&e(Le,{})]})};export{Pr as default};
